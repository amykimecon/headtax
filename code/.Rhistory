BORNIRE = ifelse(BPL == "Ireland", 1, 0), BORNAUS = ifelse(BPL == "Austria", 1, 0))
# binding all years and cleaning together
clean_all <- bind_rows(clean1881, clean1891) %>% bind_rows(clean1901) %>%
bind_rows(clean1911) %>% bind_rows(clean1921) %>%
mutate(AGE = ifelse(AGE > 200, NA, AGE),
YRIMM = ifelse(YRIMM < 1500 | YRIMM > YEAR, NA, YRIMM))
clean_imm <- clean_all %>% filter(IMM == 1)
clean_chi <- clean_all %>% filter(BORNCHI == 1)
# #### IMPUTING RACE/ETHNICITY FROM NAME FOR 1852 AND 1871 DATA ####
# ## using predictrace package
# library(predictrace)
# chineselastnames <- predict_race(unique(str_remove(str_extract(clean_chi$LASTNAME, "^[A-z]+ "), " $")))
# chineselastnames2 <- predict_ethnicity(lastnames = na.omit(unique(str_remove(str_extract(clean_chi$LASTNAME, "^[A-z]+ "), " $"))), method = "lastname")
#
# chinesefirstnames <- predict_race(unique(str_remove(str_extract(clean_chi$FIRSTNAME, "^[A-z]+ "), " $")), surname = FALSE)
#
# clean1852 <- raw1852 %>% mutate(firstname = str_remove(str_extract(namfrst, "^[A-z]+ "), " $"),
#                                 lastname = str_remove(namlast, "\\s+$"),
#                                 firstname_predrace = predict_race(firstname, surname = FALSE)$likely_race,
#                                 lastname_predrace = predict_race(lastname)$likely_race,
#                                 predasian = ifelse(firstname_predrace == "asian" & lastname_predrace == "asian", 1, 0),
#                                 predchi = ifelse((str_to_lower(lastname) %in% str_to_lower(chineselastnames)) & nchar(lastname) > 1 & lastname_predrace == "asian", 1, 0))
write_csv(clean_all, glue("{dbox}/cleaned/census_all.csv"))
# check occupation dist over years
clean_all_occ <- clean_all %>% group_by(YEAR) %>% summarize(pct_labor1 = sum(LABOR, na.rm=TRUE)/n(),
pct_labor = sum(ifelse(OCCGRP == "Laborer", 1, 0), na.rm=TRUE)/sum(ifelse(!is.na(OCCGRP), 1, 0)),
pct_farmer = sum(ifelse(OCCGRP == "Farmer", 1, 0), na.rm=TRUE)/sum(ifelse(!is.na(OCCGRP), 1, 0)),
pct_unskilled = sum(ifelse(OCCGRP == "Unskilled", 1, 0), na.rm=TRUE)/sum(ifelse(!is.na(OCCGRP), 1, 0)),
pct_skilled = sum(ifelse(OCCGRP == "Skilled", 1, 0), na.rm=TRUE)/sum(ifelse(!is.na(OCCGRP), 1, 0)),
pct_na = sum(ifelse(is.na(OCCGRP), 1, 0))/sum(ifelse(!is.na(OCCGRP), 1, 0)))
library(xtable)
?bind_rows
clean_all <- read_csv(glue("{dbox}/cleaned/census_all.csv"), guess_max = 5715448) %>% mutate(group = "All")
clean_imm <- clean_all %>% filter(IMM == 1) %>% mutate(group = "Immigrants")
clean_chi <- clean_all %>% filter(BORNCHI == 1) %>% mutate(group = "Chinese Imm.")
summ_ca_census <- bind_rows(clean_all, clean_imm, clean_chi) %>% select(c(group, MALE, MAR, AGE, CANREAD, EARN, LABOR, HOUSEOWN, RURAL, YRIMM, WEIGHT)) %>%
group_by(group) %>% summarize(across(-c(WEIGHT), .fns = c(~round(weighted.mean(.x, WEIGHT, na.rm=TRUE), 2), #weighted mean
~ifelse(is.na(mean(.x,na.rm=TRUE)),
NA,
paste0("(", round(sqrt(wtd.var(.x, WEIGHT, na.rm=TRUE)), 2), ")")))), #weighted sd
OBS = n())
View(summ_ca_census)
us_clean <- us_raw %>%
mutate(BORNCHI = ifelse(BPL == 500, 1, 0),
BORNGER = ifelse(BPL == 453, 1, 0),
BORNAUS = ifelse(BPL == 450, 1, 0),
BORNFRA = ifelse(BPL == 421, 1, 0),
BORNIRE = ifelse(BPL == 414, 1, 0),
BORNJAP = ifelse(BPL == 501, 1, 0),
BORNIND = ifelse(BPL == 521, 1, 0),
BORNRUS = ifelse(BPL == 465, 1, 0),
IMM = ifelse(NATIVITY == 5, 1, 0),
YRIMM = YRIMMIG,
MALE = ifelse(SEX == 1, 1, 0),
CANREAD = ifelse(LIT == 3 | LIT == 4, 1, 0),
MAR = ifelse(MARST == 1 | MARST == 2, 1, 0),
LABOR = ifelse((OCC1950 <= 970 & OCC1950 >= 900), 1, 0)) %>%
select(c(YEAR,starts_with("BORN"),IMM, YRIMM, AGE, MALE, CANREAD, OCC1950, LABOR, MAR))
nrow(us_raw)
library(Hmisc)
library(tidyverse)
library(glue)
library(foreign)
library(ggpubr)
library(readxl)
library(stargazer)
########################################################################
### DEFINING PATHS
########################################################################
if (Sys.getenv("USER") == "amykim"){
dbox = "/Users/amykim/Dropbox (Princeton)/head_tax_data"
git = "/Users/amykim/Documents/GitHub/headtax"
}
ca <- "#F8766D"
us <- "#00BFC4"
ht <- "#808080"
########################################################################
### IMPORTING DATA
########################################################################
## chinese registry -- immigration data through ports
reg_chi <- read_csv(glue("{dbox}/cleaned/chireg.csv")) %>% mutate(source = "xRegister", group = "Chinese Immigrants", WEIGHT = 1, YRIMM = YEAR_ARRIV)
## census data
can_imm <- read_csv(glue("{dbox}/cleaned/can_clean_imm.csv")) %>% mutate(source = "CA Census", group = "All Immigrants")
can_chi <- can_imm %>% filter(BORNCHI == 1) %>% mutate(group = "Chinese Immigrants")
can_jap <- can_imm %>% filter(BORNJAP == 1) %>% mutate(group = "Japanese Immigrants")
## us census data
us_imm <- read_csv(glue("{dbox}/cleaned/us_clean_imm.csv")) %>% mutate(source = "US Census", group = "All Immigrants", WEIGHT = 1)
us_chi <- us_imm %>% filter(BORNCHI == 1) %>% mutate(group = "Chinese Immigrants")
us_jap <- us_imm %>% filter(BORNJAP == 1) %>% mutate(group = "Japanese Immigrants")
## key head tax years for graphing & labeling vertical lines
headtaxcuts <- data.frame(yrs = c(1885, 1900, 1903, 1923), labs = c("Initial Head Tax", "Incr. to $100", "Incr. to $500", "Total Imm. Ban"))
########################################################################
### QUICK ACCOUNTING EXERICSE: OUTMIGRATION IN CANADA
########################################################################
chipop_census <- can_chi %>% group_by(YEAR) %>% summarize(pop = sum(WEIGHT))
chipop_reg <- reg_chi %>% filter(YEAR_ARRIV < 1921 & YEAR_ARRIV >= 1901) %>%
mutate(YEAR_GRP = case_when(YEAR_ARRIV < 1911 ~ "1901-1911",
YEAR_ARRIV < 1921 ~ "1911-1921")) %>%
group_by(YEAR_GRP) %>% summarize(inflow = n())
chipop_grp <- chipop_reg %>% mutate(CENSUSDIFF = diff(chipop_census$pop),
outflow = inflow - CENSUSDIFF)
us_summ <- read_csv(glue("{dbox}/cleaned/us_all_summ.csv"))
# canada -- entire population
can_summ <- read_csv(glue("{dbox}/cleaned/can_all_summ.csv"))
# computing and binding all summary stats for other groups
summ_stats_df <- bind_rows(us_summ, can_summ,
summstats(us_imm),
summstats(us_chi),
summstats(us_jap),
summstats(can_imm),
summstats(can_chi),
summstats(can_jap),
summstats(reg_chi, vars = c("MALE", "AGE", "LABOR", "YRIMM"))) %>%
select(c(-OBS, OBS)) %>%
arrange(across(c(group, source)))
## HELPER FUNCTIONS
## SUMMARY STATS TABLES
# helper function to calculate weighted standard errors
wtd_se <- function(x, w){
i <- !is.na(x)
w <- w[i]
x <- x[i]
n_eff = (sum(w)**2)/sum(w**2)
return(sqrt(wtd.var(x, w)/(n_eff)))
}
# helper function to create summary stats for a given dataset, given list of variables
summstats <- function(rawdata, vars = c("MALE", "MAR", "AGE", "CANREAD", "LABOR", "EARN", "YRIMM")){
outdata <- rawdata %>% select(c(source, group, WEIGHT, all_of(vars))) %>%
group_by(source, group) %>%
summarize(across(-c(WEIGHT),
.fns = c(~weighted.mean(.x, WEIGHT, na.rm=TRUE), #mean
~wtd_se(.x, WEIGHT))), #SE
OBS = n()) #n obs
return(outdata)
}
# computing and binding all summary stats for other groups
summ_stats_df <- bind_rows(us_summ, can_summ,
summstats(us_imm),
summstats(us_chi),
summstats(us_jap),
summstats(can_imm),
summstats(can_chi),
summstats(can_jap),
summstats(reg_chi, vars = c("MALE", "AGE", "LABOR", "YRIMM"))) %>%
select(c(-OBS, OBS)) %>%
arrange(across(c(group, source)))
summ_stats_out <- t(summ_stats_df) %>% as.data.frame()
# writing
summ_cats <- c("\\% Male", "\\% Married*", "Age", "\\% Literate*", "\\% Laborers*", "Earnings","Year of Imm.")
summtex <- file(glue("{git}/figs/summstats.tex"), open = "w")
writeLines(c("\\begin{tabular}{lcccccccccccc}",
"\\hhline{=============}",
"& \\multicolumn{2}{c}{Entire Population} & & \\multicolumn{2}{c}{All Immigrants} & & \\multicolumn{3}{c}{Chinese Immigrants} & & \\multicolumn{2}{c}{Japanese Immigrants} \\\\ ",
"\\hhline{~--~--~---~--}", "& (1) & (2) & & (3) & (4) & & (5) & (6) & (7) & & (8) & (9) \\\\ ",
"& CA Census & US Census & & CA Census & US Census & & CA Census & US Census & Chinese Reg. & & CA Census & US Census \\\\ ", " \\hhline{-------------}"), summtex)
for (i in 1:length(summ_cats)){
means <- ifelse(is.na(summ_stats_out[2*i+1,]), "-", summ_stats_out[2*i+1,])
sds <- ifelse(is.na(summ_stats_out[2*i+2,]), "", paste0("(",round(as.numeric(summ_stats_out[2*i+2,]),4),")"))
writeLines(c(paste(summ_cats[i], "&", glue_collapse(c(means[1:2],"",means[3:4],"",means[5:7], "", means[8:9]), sep = "&", last = ""), "\\\\ "),
paste("&", glue_collapse(c(sds[1:2],"",sds[3:4],"",sds[5:7], "", sds[8:9]), sep = "&", last = ""), "\\\\ ")), summtex)
}
obs <- ifelse(is.na(summ_stats_out[2*(length(summ_cats)+1)+1,]), "-", round(as.numeric(summ_stats_out[2*(length(summ_cats)+1)+1,])/1000, 0))
writeLines(c("Obs. (Thousands)", "&", glue_collapse(c(obs[1:2],"",obs[3:4],"",obs[5:7],"", obs[8:9]), sep = "&", last = ""), "\\\\ "), summtex)
writeLines(c("\\hhline{-------------}","\\end{tabular}"), summtex)
close(summtex)
# computing and binding all summary stats for other groups
summ_stats_df <- bind_rows(#us_summ, #can_summ,
summstats(us_imm),
summstats(us_chi),
summstats(us_jap),
summstats(can_imm),
summstats(can_chi),
summstats(can_jap),
summstats(reg_chi, vars = c("MALE", "AGE", "LABOR", "YRIMM"))) %>%
select(c(-OBS, OBS)) %>%
arrange(across(c(group, source)))
summ_stats_out <- t(summ_stats_df) %>% as.data.frame()
summ_stats_out
# writing
summ_cats <- c("\\% Male", "\\% Married*", "Age", "\\% Literate*", "\\% Laborers*", "Earnings","Year of Imm.")
summtex <- file(glue("{git}/figs/summstats.tex"), open = "w")
writeLines(c("\\begin{tabular}{lcccccccccc}",
"\\hhline{=============}",
"& \\multicolumn{2}{c}{All Foreign-Born} & & \\multicolumn{3}{c}{Chinese Immigrants} & & \\multicolumn{2}{c}{Japanese Immigrants} \\\\ ",
"\\hhline{~--~--~---~--}", "& (1) & (2) & & (3) & (4) & & (5) & (6) & (7) & & (8) & (9) \\\\ ",
"& CA Census & US Census & & CA Census & US Census & Chinese Reg. & & CA Census & US Census \\\\ ", " \\hhline{-------------}"), summtex)
for (i in 1:length(summ_cats)){
means <- ifelse(is.na(summ_stats_out[2*i+1,]), "-", summ_stats_out[2*i+1,])
sds <- ifelse(is.na(summ_stats_out[2*i+2,]), "", paste0("(",round(as.numeric(summ_stats_out[2*i+2,]),4),")"))
writeLines(c(paste(summ_cats[i], "&", glue_collapse(c(means[1:2],"",means[3:5],"",means[6:7]), sep = "&", last = ""), "\\\\ "),
paste("&", glue_collapse(c(sds[1:2],"",sds[3:5],"",sds[6:8]), sep = "&", last = ""), "\\\\ ")), summtex)
}
obs <- ifelse(is.na(summ_stats_out[2*(length(summ_cats)+1)+1,]), "-", round(as.numeric(summ_stats_out[2*(length(summ_cats)+1)+1,])/1000, 0))
writeLines(c("Obs. (Thousands)", "&", glue_collapse(c(obs[1:2],"",obs[3:5],"",obs[6:7]), sep = "&", last = ""), "\\\\ "), summtex)
writeLines(c("\\hhline{-------------}","\\end{tabular}"), summtex)
close(summtex)
# writing
summ_cats <- c("\\% Male", "\\% Married*", "Age", "\\% Literate*", "\\% Laborers*", "Earnings","Year of Imm.")
summtex <- file(glue("{git}/figs/summstats.tex"), open = "w")
writeLines(c("\\begin{tabular}{lcccccccccc}",
"\\hhline{===========}",
"& \\multicolumn{2}{c}{All Foreign-Born} & & \\multicolumn{3}{c}{Chinese Immigrants} & & \\multicolumn{2}{c}{Japanese Immigrants} \\\\ ",
"\\hhline{~--~--~---~--}", "& (1) & (2) & & (3) & (4) & & (5) & (6) & (7) \\\\ ",
"& CA Census & US Census & & CA Census & US Census & Chinese Reg. & & CA Census & US Census \\\\ ", " \\hhline{-----------}"), summtex)
for (i in 1:length(summ_cats)){
means <- ifelse(is.na(summ_stats_out[2*i+1,]), "-", summ_stats_out[2*i+1,])
sds <- ifelse(is.na(summ_stats_out[2*i+2,]), "", paste0("(",round(as.numeric(summ_stats_out[2*i+2,]),4),")"))
writeLines(c(paste(summ_cats[i], "&", glue_collapse(c(means[1:2],"",means[3:5],"",means[6:7]), sep = "&", last = ""), "\\\\ "),
paste("&", glue_collapse(c(sds[1:2],"",sds[3:5],"",sds[6:8]), sep = "&", last = ""), "\\\\ ")), summtex)
}
obs <- ifelse(is.na(summ_stats_out[2*(length(summ_cats)+1)+1,]), "-", round(as.numeric(summ_stats_out[2*(length(summ_cats)+1)+1,])/1000, 0))
writeLines(c("Obs. (Thousands)", "&", glue_collapse(c(obs[1:2],"",obs[3:5],"",obs[6:7]), sep = "&", last = ""), "\\\\ "), summtex)
writeLines(c("\\hhline{-----------}","\\end{tabular}"), summtex)
close(summtex)
# writing
summ_cats <- c("\\% Male", "\\% Married*", "Age", "\\% Literate*", "\\% Laborers*", "Earnings","Year of Imm.")
summtex <- file(glue("{git}/figs/summstats.tex"), open = "w")
writeLines(c("\\begin{tabular}{lccccccccc}",
"\\hhline{===========}",
"& \\multicolumn{2}{c}{All Foreign-Born} & & \\multicolumn{3}{c}{Chinese Immigrants} & & \\multicolumn{2}{c}{Japanese Immigrants} \\\\ ",
"\\hhline{~--~---~--}", "& (1) & (2) & & (3) & (4) & & (5) & (6) & (7) \\\\ ",
"& CA Census & US Census & & CA Census & US Census & Chinese Reg. & & CA Census & US Census \\\\ ", " \\hhline{-----------}"), summtex)
for (i in 1:length(summ_cats)){
means <- ifelse(is.na(summ_stats_out[2*i+1,]), "-", summ_stats_out[2*i+1,])
sds <- ifelse(is.na(summ_stats_out[2*i+2,]), "", paste0("(",round(as.numeric(summ_stats_out[2*i+2,]),4),")"))
writeLines(c(paste(summ_cats[i], "&", glue_collapse(c(means[1:2],"",means[3:5],"",means[6:7]), sep = "&", last = ""), "\\\\ "),
paste("&", glue_collapse(c(sds[1:2],"",sds[3:5],"",sds[6:8]), sep = "&", last = ""), "\\\\ ")), summtex)
}
obs <- ifelse(is.na(summ_stats_out[2*(length(summ_cats)+1)+1,]), "-", round(as.numeric(summ_stats_out[2*(length(summ_cats)+1)+1,])/1000, 0))
writeLines(c("Obs. (Thousands)", "&", glue_collapse(c(obs[1:2],"",obs[3:5],"",obs[6:7]), sep = "&", last = ""), "\\\\ "), summtex)
writeLines(c("\\hhline{-----------}","\\end{tabular}"), summtex)
close(summtex)
# writing
summ_cats <- c("\\% Male", "\\% Married*", "Age", "\\% Literate*", "\\% Laborers*", "Earnings","Year of Imm.")
summtex <- file(glue("{git}/figs/summstats.tex"), open = "w")
writeLines(c("\\begin{tabular}{lccccccccc}",
"\\hhline{==========}",
"& \\multicolumn{2}{c}{All Foreign-Born} & & \\multicolumn{3}{c}{Chinese Immigrants} & & \\multicolumn{2}{c}{Japanese Immigrants} \\\\ ",
"\\hhline{~--~---~--}", "& (1) & (2) & & (3) & (4) & & (5) & (6) & (7) \\\\ ",
"& CA Census & US Census & & CA Census & US Census & Chinese Reg. & & CA Census & US Census \\\\ ", " \\hhline{----------}"), summtex)
for (i in 1:length(summ_cats)){
means <- ifelse(is.na(summ_stats_out[2*i+1,]), "-", summ_stats_out[2*i+1,])
sds <- ifelse(is.na(summ_stats_out[2*i+2,]), "", paste0("(",round(as.numeric(summ_stats_out[2*i+2,]),4),")"))
writeLines(c(paste(summ_cats[i], "&", glue_collapse(c(means[1:2],"",means[3:5],"",means[6:7]), sep = "&", last = ""), "\\\\ "),
paste("&", glue_collapse(c(sds[1:2],"",sds[3:5],"",sds[6:8]), sep = "&", last = ""), "\\\\ ")), summtex)
}
obs <- ifelse(is.na(summ_stats_out[2*(length(summ_cats)+1)+1,]), "-", round(as.numeric(summ_stats_out[2*(length(summ_cats)+1)+1,])/1000, 0))
writeLines(c("Obs. (Thousands)", "&", glue_collapse(c(obs[1:2],"",obs[3:5],"",obs[6:7]), sep = "&", last = ""), "\\\\ "), summtex)
writeLines(c("\\hhline{----------}","\\end{tabular}"), summtex)
close(summtex)
# writing
summ_cats <- c("\\% Male", "\\% Married*", "Age", "\\% Literate*", "\\% Laborers*", "Earnings","Year of Imm.")
summtex <- file(glue("{git}/figs/summstats.tex"), open = "w")
writeLines(c("\\begin{tabular}{lccccccccc}",
"\\hhline{==========}",
"& \\multicolumn{2}{c}{All Foreign-Born} & & \\multicolumn{3}{c}{Chinese Immigrants} & & \\multicolumn{2}{c}{Japanese Immigrants} \\\\ ",
"\\hhline{~--~---~--}", "& (1) & (2) & & (3) & (4) & (5) & & (6) & (7) \\\\ ",
"& CA Census & US Census & & CA Census & US Census & Chinese Reg. & & CA Census & US Census \\\\ ", " \\hhline{----------}"), summtex)
for (i in 1:length(summ_cats)){
means <- ifelse(is.na(summ_stats_out[2*i+1,]), "-", summ_stats_out[2*i+1,])
sds <- ifelse(is.na(summ_stats_out[2*i+2,]), "", paste0("(",round(as.numeric(summ_stats_out[2*i+2,]),4),")"))
writeLines(c(paste(summ_cats[i], "&", glue_collapse(c(means[1:2],"",means[3:5],"",means[6:7]), sep = "&", last = ""), "\\\\ "),
paste("&", glue_collapse(c(sds[1:2],"",sds[3:5],"",sds[6:8]), sep = "&", last = ""), "\\\\ ")), summtex)
}
obs <- ifelse(is.na(summ_stats_out[2*(length(summ_cats)+1)+1,]), "-", round(as.numeric(summ_stats_out[2*(length(summ_cats)+1)+1,])/1000, 0))
writeLines(c("Obs. (Thousands)", "&", glue_collapse(c(obs[1:2],"",obs[3:5],"",obs[6:7]), sep = "&", last = ""), "\\\\ "), summtex)
writeLines(c("\\hhline{----------}","\\end{tabular}"), summtex)
close(summtex)
# writing
summ_cats <- c("\\% Male", "\\% Married*", "Age", "\\% Literate*", "\\% Laborers*", "Earnings","Year of Imm.")
summtex <- file(glue("{git}/figs/summstats.tex"), open = "w")
writeLines(c("\\begin{tabular}{lccccccccc}",
"\\hhline{==========}",
"& \\multicolumn{2}{c}{All Foreign-Born} & & \\multicolumn{3}{c}{Chinese Immigrants} & & \\multicolumn{2}{c}{Japanese Immigrants} \\\\ ",
"\\hhline{~--~---~--}", "& (1) & (2) & & (3) & (4) & (5) & & (6) & (7) \\\\ ",
"& CA Census & US Census & & CA Census & US Census & Chinese Reg. & & CA Census & US Census \\\\ ", " \\hhline{----------}"), summtex)
for (i in 1:length(summ_cats)){
means <- ifelse(is.na(summ_stats_out[2*i+1,]), "-", summ_stats_out[2*i+1,])
sds <- ifelse(is.na(summ_stats_out[2*i+2,]), "", paste0("(",round(as.numeric(summ_stats_out[2*i+2,]),4),")"))
writeLines(c(paste(summ_cats[i], "&", glue_collapse(c(means[1:2],"",means[3:5],"",means[6:7]), sep = "&", last = ""), "\\\\ "),
paste("&", glue_collapse(c(sds[1:2],"",sds[3:5],"",sds[6:7]), sep = "&", last = ""), "\\\\ ")), summtex)
}
obs <- ifelse(is.na(summ_stats_out[2*(length(summ_cats)+1)+1,]), "-", round(as.numeric(summ_stats_out[2*(length(summ_cats)+1)+1,])/1000, 0))
writeLines(c("Obs. (Thousands)", "&", glue_collapse(c(obs[1:2],"",obs[3:5],"",obs[6:7]), sep = "&", last = ""), "\\\\ "), summtex)
writeLines(c("\\hhline{----------}","\\end{tabular}"), summtex)
close(summtex)
summ_stats_out <- t(summ_stats_df) %>% as.data.frame()
# writing
summ_cats <- c("\\% Male", "\\% Married*", "Age", "\\% Literate*", "\\% Laborers*", "Earnings","Year of Imm.")
summtex <- file(glue("{git}/figs/summstats.tex"), open = "w")
writeLines(c("\\begin{tabular}{lccccccccc}",
"\\hhline{==========}",
"& \\multicolumn{2}{c}{All Foreign-Born} & & \\multicolumn{3}{c}{Chinese Immigrants} & & \\multicolumn{2}{c}{Japanese Immigrants} \\\\ ",
"\\hhline{~--~---~--}", "& (1) & (2) & & (3) & (4) & (5) & & (6) & (7) \\\\ ",
"& CA Census & US Census & & CA Census & US Census & Chinese Reg. & & CA Census & US Census \\\\ ", " \\hhline{----------}"), summtex)
for (i in 1:length(summ_cats)){
means <- ifelse(is.na(summ_stats_out[2*i+1,]), "-", summ_stats_out[2*i+1,])
sds <- ifelse(is.na(summ_stats_out[2*i+2,]), "", paste0("(",round(as.numeric(summ_stats_out[2*i+2,]),4),")"))
writeLines(c(paste(summ_cats[i], "&", glue_collapse(c(means[1:2],"",means[3:5],"",means[6:7]), sep = "&", last = ""), "\\\\ "),
paste("&", glue_collapse(c(sds[1:2],"",sds[3:5],"",sds[6:7]), sep = "&", last = ""), "\\\\ ")), summtex)
}
obs <- ifelse(is.na(summ_stats_out[2*(length(summ_cats)+1)+1,]), "-", round(as.numeric(summ_stats_out[2*(length(summ_cats)+1)+1,]), 0))
writeLines(c("Obs. (Thousands)", "&", glue_collapse(c(obs[1:2],"",obs[3:5],"",obs[6:7]), sep = "&", last = ""), "\\\\ "), summtex)
writeLines(c("\\hhline{----------}","\\end{tabular}"), summtex)
close(summtex)
fig2_flow <- ggplot(data = yrimm_all, aes(x = YRIMM, y = CHIPOP, linetype = source, color = source)) + geom_line() +
geom_vline(aes(xintercept = yrs), data = headtaxcuts, show.legend = FALSE) +
geom_text(aes(x = yrs, y = 7000, label = labs), data = headtaxcuts, inherit.aes = FALSE, angle = 90, nudge_x = 0.8, size = 4) +
scale_linetype_manual(breaks=c("Chinese Register","CA Census"), values=c(1,2)) +
labs(x = "Year of Immigration", y = "Inflow of Chinese Immigrants", linetype = "Data Source") + theme_minimal() + theme(legend.position='bottom')
yrimm_census <- can_chi %>% group_by(YEAR, YRIMM) %>% summarize(CHIPOP = sum(WEIGHT)) %>% mutate(source = "CA Census", tax = case_when(YRIMM <= 1885 ~ 0,
YRIMM <= 1900 ~ 50,
YRIMM <= 1903 ~ 100,
YRIMM < 1924 ~ 500)) %>%
arrange(YRIMM) %>%
filter((YEAR == 1901 & YRIMM < 1901) | (YEAR == 1911 & YRIMM < 1911 & YRIMM >= 1901) | (YEAR == 1921 & YRIMM < 1921 & YRIMM >= 1911)) # only taking YRIMM from most recent census (lowest rate of loss to outmigration)
yrimm_reg <- reg_chi %>% mutate(YRIMM = YEAR_ARRIV) %>% group_by(YRIMM) %>% summarize(CHIPOP = n()) %>% mutate(source = "Chinese Register",
tax = case_when(YRIMM <= 1885 ~ 0,
YRIMM <= 1900 ~ 50,
YRIMM <= 1903 ~ 100,
YRIMM < 1924 ~ 500)) %>%
arrange(YRIMM) %>% filter(YRIMM >= 1880 & YRIMM <= 1930)
yrimm_census_allim <- can_imm %>% group_by(YEAR, YRIMM) %>% summarize(IMMPOP = sum(WEIGHT),
MATCHPOP = sum(ifelse(matched == 1, WEIGHT, 0)),
JAPPOP = sum(ifelse(BORNJAP == 1, WEIGHT, 0)),
CHIPOP = sum(ifelse(BORNCHI == 1, WEIGHT, 0)),
AUSPOP = sum(ifelse(BORNAUS == 1, WEIGHT, 0))) %>%
mutate(source = "CA Census", tax = case_when(YRIMM <= 1885 ~ 0,
YRIMM <= 1900 ~ 50,
YRIMM <= 1903 ~ 100,
YRIMM < 1924 ~ 500)) %>% filter(YRIMM >= 1880) %>%
arrange(YRIMM) %>%
filter((YEAR == 1901 & YRIMM < 1901) | (YEAR == 1911 & YRIMM < 1911 & YRIMM >= 1901) | (YEAR == 1921 & YRIMM < 1921 & YRIMM >= 1911)) %>% # only taking YRIMM from most recent census (lowest rate of loss to outmigration)
mutate(CHIFRAC = CHIPOP/IMMPOP, JAPFRAC = JAPPOP/IMMPOP, AUSFRAC = AUSPOP/IMMPOP, CHIJAP = CHIPOP/JAPPOP)
yrimm_census_allim <- can_imm %>% group_by(YEAR, YRIMM) %>% summarize(IMMPOP = sum(WEIGHT),
JAPPOP = sum(ifelse(BORNJAP == 1, WEIGHT, 0)),
CHIPOP = sum(ifelse(BORNCHI == 1, WEIGHT, 0)),
AUSPOP = sum(ifelse(BORNAUS == 1, WEIGHT, 0))) %>%
mutate(source = "CA Census", tax = case_when(YRIMM <= 1885 ~ 0,
YRIMM <= 1900 ~ 50,
YRIMM <= 1903 ~ 100,
YRIMM < 1924 ~ 500)) %>% filter(YRIMM >= 1880) %>%
arrange(YRIMM) %>%
filter((YEAR == 1901 & YRIMM < 1901) | (YEAR == 1911 & YRIMM < 1911 & YRIMM >= 1901) | (YEAR == 1921 & YRIMM < 1921 & YRIMM >= 1911)) %>% # only taking YRIMM from most recent census (lowest rate of loss to outmigration)
mutate(CHIFRAC = CHIPOP/IMMPOP, JAPFRAC = JAPPOP/IMMPOP, AUSFRAC = AUSPOP/IMMPOP, CHIJAP = CHIPOP/JAPPOP)
yrimm_census_allim <- can_imm %>% group_by(YEAR, YRIMM) %>% summarize(IMMPOP = sum(WEIGHT),
JAPPOP = sum(ifelse(BORNJAP == 1, WEIGHT, 0)),
CHIPOP = sum(ifelse(BORNCHI == 1, WEIGHT, 0))) %>%
mutate(source = "CA Census", tax = case_when(YRIMM <= 1885 ~ 0,
YRIMM <= 1900 ~ 50,
YRIMM <= 1903 ~ 100,
YRIMM < 1924 ~ 500)) %>% filter(YRIMM >= 1880) %>%
arrange(YRIMM) %>%
filter((YEAR == 1901 & YRIMM < 1901) | (YEAR == 1911 & YRIMM < 1911 & YRIMM >= 1901) | (YEAR == 1921 & YRIMM < 1921 & YRIMM >= 1911)) %>% # only taking YRIMM from most recent census (lowest rate of loss to outmigration)
mutate(CHIFRAC = CHIPOP/IMMPOP, JAPFRAC = JAPPOP/IMMPOP, AUSFRAC = AUSPOP/IMMPOP, CHIJAP = CHIPOP/JAPPOP)
yrimm_census_allim <- can_imm %>% group_by(YEAR, YRIMM) %>% summarize(IMMPOP = sum(WEIGHT),
JAPPOP = sum(ifelse(BORNJAP == 1, WEIGHT, 0)),
CHIPOP = sum(ifelse(BORNCHI == 1, WEIGHT, 0))) %>%
mutate(source = "CA Census", tax = case_when(YRIMM <= 1885 ~ 0,
YRIMM <= 1900 ~ 50,
YRIMM <= 1903 ~ 100,
YRIMM < 1924 ~ 500)) %>% filter(YRIMM >= 1880) %>%
arrange(YRIMM) %>%
filter((YEAR == 1901 & YRIMM < 1901) | (YEAR == 1911 & YRIMM < 1911 & YRIMM >= 1901) | (YEAR == 1921 & YRIMM < 1921 & YRIMM >= 1911)) %>% # only taking YRIMM from most recent census (lowest rate of loss to outmigration)
mutate(CHIFRAC = CHIPOP/IMMPOP, JAPFRAC = JAPPOP/IMMPOP, CHIJAP = CHIPOP/JAPPOP)
yrimm_all <- rbind(filter(yrimm_census, YRIMM >= 1880), yrimm_reg)
fig2_flow <- ggplot(data = yrimm_all, aes(x = YRIMM, y = CHIPOP, linetype = source, color = source)) + geom_line() +
geom_vline(aes(xintercept = yrs), data = headtaxcuts, show.legend = FALSE) +
geom_text(aes(x = yrs, y = 7000, label = labs), data = headtaxcuts, inherit.aes = FALSE, angle = 90, nudge_x = 0.8, size = 4) +
scale_linetype_manual(breaks=c("Chinese Register","CA Census"), values=c(1,2)) +
labs(x = "Year of Immigration", y = "Inflow of Chinese Immigrants", linetype = "Data Source") + theme_minimal() + theme(legend.position='bottom')
ggsave(glue("{git}/figs/fig2_flow.png"), fig2_flow, height = 5, width = 9)
fig2_flow
ggplot(data = yrimm_all, aes(x = YRIMM, y = CHIPOP, linetype = source, color = source)) + geom_line() +
geom_vline(aes(xintercept = yrs), data = headtaxcuts, show.legend = FALSE) +
geom_text(aes(x = yrs, y = 7000, label = labs), data = headtaxcuts, inherit.aes = FALSE, angle = 90, nudge_x = 0.8, size = 4) +
labs(x = "Year of Immigration", y = "Inflow of Chinese Immigrants", linetype = "Data Source") + theme_minimal() + theme(legend.position='bottom')
fig2_flow <- ggplot(data = yrimm_all, aes(x = YRIMM, y = CHIPOP, linetype = source, color = source)) + geom_line() +
geom_vline(aes(xintercept = yrs), data = headtaxcuts, show.legend = FALSE) +
geom_text(aes(x = yrs, y = 7000, label = labs), data = headtaxcuts, inherit.aes = FALSE, angle = 90, nudge_x = 0.8, size = 4) +
scale_linetype_manual(breaks=c("Chinese Register","CA Census"), values=c(1,2)) +
labs(x = "Year of Immigration", y = "Inflow of Chinese Immigrants", linetype = "Data Source", color = "Data Source") + theme_minimal() + theme(legend.position='bottom')
ggplot(data = yrimm_all, aes(x = YRIMM, y = CHIPOP, linetype = source, color = source)) + geom_line() +
geom_vline(aes(xintercept = yrs), data = headtaxcuts, show.legend = FALSE) +
geom_text(aes(x = yrs, y = 7000, label = labs), data = headtaxcuts, inherit.aes = FALSE, angle = 90, nudge_x = 0.8, size = 4) +
scale_linetype_manual(breaks=c("Chinese Register","CA Census"), values=c(1,2)) +
labs(x = "Year of Immigration", y = "Inflow of Chinese Immigrants", linetype = "Data Source", color = "Data Source") + theme_minimal() + theme(legend.position='bottom')
ggplot(data = yrimm_all, aes(x = YRIMM, y = CHIPOP, linetype = source, color = source)) + geom_line() +
geom_vline(aes(xintercept = yrs), data = headtaxcuts, show.legend = FALSE) +
geom_text(aes(x = yrs, y = 7000, label = labs), data = headtaxcuts, inherit.aes = FALSE, angle = 90, nudge_x = 0.8, size = 4) +
#scale_linetype_manual(breaks=c("Chinese Register","CA Census"), values=c(1,2)) +
labs(x = "Year of Immigration", y = "Inflow of Chinese Immigrants", linetype = "Data Source", color = "Data Source") + theme_minimal() + theme(legend.position='bottom')
fig2_flow <- ggplot(data = yrimm_all, aes(x = YRIMM, y = CHIPOP, linetype = source, color = source)) + geom_line() +
geom_vline(aes(xintercept = yrs), data = headtaxcuts, show.legend = FALSE) +
geom_text(aes(x = yrs, y = 7000, label = labs), data = headtaxcuts, inherit.aes = FALSE, angle = 90, nudge_x = 0.8, size = 4) +
#scale_linetype_manual(breaks=c("Chinese Register","CA Census"), values=c(1,2)) +
labs(x = "Year of Immigration", y = "Inflow of Chinese Immigrants", linetype = "Data Source", color = "Data Source") + theme_minimal() + theme(legend.position='bottom')
ggsave(glue("{git}/figs/fig2_flow.png"), fig2_flow, height = 5, width = 9)
fig2_flow
tax_by_year_reg <- reg_chi %>% filter(REG_Year != 0) %>% group_by(REG_Year) %>%
summarize(n=n(), tax = mean(ifelse(FEES > 0, FEES, NA), na.rm=TRUE),
taxpayers = sum(ifelse(FEES > 0, 1, 0), na.rm=TRUE)/n) %>% rename(YEAR = REG_Year) %>%
mutate(CAT = "Year Registered")
tax_by_year_arriv <- reg_chi %>% group_by(YEAR_ARRIV) %>% summarize(n=n(), tax = mean(ifelse(FEES > 0, FEES, NA), na.rm=TRUE)) %>% rename(YEAR = YEAR_ARRIV) %>%
mutate(CAT = "Year Arrived")
fig1_taxespaid <- ggplot(tax_by_year_arriv %>% filter(YEAR <= 1923), aes(x = YEAR, y = tax)) + geom_line() +
geom_vline(aes(xintercept = yrs), data = headtaxcuts, show.legend = FALSE, color = ht) +
geom_text(aes(x = yrs, y = 400, label = labs), data = headtaxcuts, inherit.aes = FALSE, angle = 90, nudge_x = -1.2, size = 4, color = ht) + expand_limits(y = 0) +
xlab("Year of Arrival") + ylab("Average Tax Paid Among Tax Payers") + theme_minimal()
ggsave(glue("{git}/figs/fig1_taxespaid.png"), fig1_taxespaid, height = 5, width = 9)
library(Hmisc)
library(tidyverse)
library(glue)
library(foreign)
library(ggpubr)
library(readxl)
library(stargazer)
########################################################################
### DEFINING PATHS
########################################################################
if (Sys.getenv("USER") == "amykim"){
dbox = "/Users/amykim/Dropbox (Princeton)/head_tax_data"
git = "/Users/amykim/Documents/GitHub/headtax"
}
ca <- "#F8766D"
us <- "#00BFC4"
ht <- "#808080"
########################################################################
### IMPORTING DATA
########################################################################
## chinese registry -- immigration data through ports
reg_chi <- read_csv(glue("{dbox}/cleaned/chireg.csv")) %>% mutate(source = "xRegister", group = "Chinese Immigrants", WEIGHT = 1, YRIMM = YEAR_ARRIV)
## census data
can_imm <- read_csv(glue("{dbox}/cleaned/can_clean_imm.csv")) %>% mutate(source = "CA Census", group = "All Immigrants")
can_chi <- can_imm %>% filter(BORNCHI == 1) %>% mutate(group = "Chinese Immigrants")
can_jap <- can_imm %>% filter(BORNJAP == 1) %>% mutate(group = "Japanese Immigrants")
## us census data
us_imm <- read_csv(glue("{dbox}/cleaned/us_clean_imm.csv")) %>% mutate(source = "US Census", group = "All Immigrants", WEIGHT = 1)
us_chi <- us_imm %>% filter(BORNCHI == 1) %>% mutate(group = "Chinese Immigrants")
us_jap <- us_imm %>% filter(BORNJAP == 1) %>% mutate(group = "Japanese Immigrants")
## key head tax years for graphing & labeling vertical lines
headtaxcuts <- data.frame(yrs = c(1885, 1900, 1903, 1923), labs = c("Initial Head Tax", "Incr. to $100", "Incr. to $500", "Total Imm. Ban"))
yrimm_census <- can_chi %>% group_by(YEAR, YRIMM) %>% summarize(CHIPOP = sum(WEIGHT)) %>% mutate(source = "CA Census", tax = case_when(YRIMM <= 1885 ~ 0,
YRIMM <= 1900 ~ 50,
YRIMM <= 1903 ~ 100,
YRIMM < 1924 ~ 500)) %>%
arrange(YRIMM) %>%
filter((YEAR == 1901 & YRIMM < 1901) | (YEAR == 1911 & YRIMM < 1911 & YRIMM >= 1901) | (YEAR == 1921 & YRIMM < 1921 & YRIMM >= 1911)) # only taking YRIMM from most recent census (lowest rate of loss to outmigration)
yrimm_reg <- reg_chi %>% mutate(YRIMM = YEAR_ARRIV) %>% group_by(YRIMM) %>% summarize(CHIPOP = n()) %>% mutate(source = "Chinese Register",
tax = case_when(YRIMM <= 1885 ~ 0,
YRIMM <= 1900 ~ 50,
YRIMM <= 1903 ~ 100,
YRIMM < 1924 ~ 500)) %>%
arrange(YRIMM) %>% filter(YRIMM >= 1880 & YRIMM <= 1930)
#
# yrimm_census_allim <- can_imm %>% group_by(YEAR, YRIMM) %>% summarize(IMMPOP = sum(WEIGHT),
#                                                                       JAPPOP = sum(ifelse(BORNJAP == 1, WEIGHT, 0)),
#                                                                       CHIPOP = sum(ifelse(BORNCHI == 1, WEIGHT, 0))) %>%
#   mutate(source = "CA Census", tax = case_when(YRIMM <= 1885 ~ 0,
#                                                                                                                                              YRIMM <= 1900 ~ 50,
#                                                                                                                                              YRIMM <= 1903 ~ 100,
#                                                                                                                                              YRIMM < 1924 ~ 500)) %>% filter(YRIMM >= 1880) %>%
#   arrange(YRIMM) %>%
#   filter((YEAR == 1901 & YRIMM < 1901) | (YEAR == 1911 & YRIMM < 1911 & YRIMM >= 1901) | (YEAR == 1921 & YRIMM < 1921 & YRIMM >= 1911)) %>% # only taking YRIMM from most recent census (lowest rate of loss to outmigration)
#   mutate(CHIFRAC = CHIPOP/IMMPOP, JAPFRAC = JAPPOP/IMMPOP, CHIJAP = CHIPOP/JAPPOP)
yrimm_all <- rbind(filter(yrimm_census, YRIMM >= 1880), yrimm_reg)
fig2_flow <- ggplot(data = yrimm_all, aes(x = YRIMM, y = CHIPOP, linetype = source, color = source)) + geom_line() +
geom_vline(aes(xintercept = yrs), data = headtaxcuts, show.legend = FALSE) +
geom_text(aes(x = yrs, y = 7000, label = labs), data = headtaxcuts, inherit.aes = FALSE, angle = 90, nudge_x = 0.8, size = 4) +
#scale_linetype_manual(breaks=c("Chinese Register","CA Census"), values=c(1,2)) +
labs(x = "Year of Immigration", y = "Inflow of Chinese Immigrants", linetype = "Data Source", color = "Data Source") + theme_minimal() + theme(legend.position='bottom')
fig2_flow
ggsave(glue("{git}/figs/fig2_flow.png"), fig2_flow, height = 5, width = 9)
yrimm_us <- us_imm %>% filter(BORNJAP == 1 | BORNCHI == 1) %>% group_by(YEAR, YRIMM) %>% summarize(ChinesePOP = sum(BORNCHI), JapanesePOP = sum(BORNJAP)) %>% mutate(source = "US Census", tax = case_when(YRIMM <= 1885 ~ 0,
YRIMM <= 1900 ~ 50,
YRIMM <= 1903 ~ 100,
YRIMM < 1924 ~ 500)) %>%
arrange(YRIMM) %>%
filter((YEAR == 1900 & YRIMM < 1900) | (YEAR == 1910 & YRIMM < 1910 & YRIMM >= 1900) | (YEAR == 1920 & YRIMM < 1920 & YRIMM >= 1910)) %>% # only taking YRIMM from most recent census (lowest rate of loss to outmigration)
pivot_longer(c(ChinesePOP, JapanesePOP), names_to = "IMM", names_pattern = "(.*)POP", values_to = "POP")
yrimm_census_jap <- can_imm %>% filter(BORNJAP == 1) %>% group_by(YEAR, YRIMM) %>% summarize(POP = sum(WEIGHT)) %>% mutate(source = "CA Census", tax = case_when(YRIMM <= 1885 ~ 0,
YRIMM <= 1900 ~ 50,
YRIMM <= 1903 ~ 100,
YRIMM < 1924 ~ 500),
IMM = "Japanese") %>%
arrange(YRIMM) %>%
filter((YEAR == 1901 & YRIMM < 1901) | (YEAR == 1911 & YRIMM < 1911 & YRIMM >= 1901) | (YEAR == 1921 & YRIMM < 1921 & YRIMM >= 1911)) # only taking YRIMM from most recent census (lowest rate of loss to outmigration)
yrimm_us_can <- bind_rows(yrimm_us, yrimm_census %>% mutate(IMM = "Chinese", POP = CHIPOP)) %>% bind_rows(yrimm_census_jap)
fig3_us_can <- ggplot(data = yrimm_us_can %>% filter(YRIMM >= 1870), aes(x = YRIMM, y = POP, color = source, linetype = IMM)) + geom_line() +
geom_vline(aes(xintercept = yrs), data = headtaxcuts[1:3,], show.legend = FALSE) +
geom_text(aes(x = yrs, y = 7000, label = labs), data = headtaxcuts[1:3,], inherit.aes = FALSE, angle = 90, nudge_x = 0.8, size = 4) +
geom_vline(aes(xintercept = x), data = data.frame(x = c(1882)), show.legend = FALSE, color = "dark blue") +
geom_text(aes(x = x, y = 7000, label = labs), data = data.frame(x = c(1882), labs = c("US Chi. Excl. Act")), inherit.aes = FALSE, angle = 90, nudge_x = 0.8, size = 4) +
scale_color_manual(breaks=c("CA Census", "US Census"), values=c("black","blue")) +
scale_linetype_manual(breaks=c("Chinese", "Japanese"), values=c(1,3)) +
labs(x = "Year of Immigration", y = "Inflow of Chinese Immigrants", linetype = "Data Source", color = "Immigrant Group") + theme_minimal() + theme(legend.position='bottom')
fig3_us_can
ca
us
library(scales)
hue_pal()(3)
hue_pal()(4)
fig3_us_can <- ggplot(data = yrimm_us_can %>% filter(YRIMM >= 1870), aes(x = YRIMM, y = POP, color = source, linetype = IMM)) + geom_line() +
geom_vline(aes(xintercept = yrs), data = headtaxcuts[1:3,], show.legend = FALSE) +
geom_text(aes(x = yrs, y = 7000, label = labs), data = headtaxcuts[1:3,], inherit.aes = FALSE, angle = 90, nudge_x = 0.8, size = 4) +
geom_vline(aes(xintercept = x), data = data.frame(x = c(1882)), show.legend = FALSE, color = "dark blue") +
geom_text(aes(x = x, y = 7000, label = labs), data = data.frame(x = c(1882), labs = c("US Chi. Excl. Act")), inherit.aes = FALSE, angle = 90, nudge_x = 0.8, size = 4) +
#scale_color_manual(breaks=c("CA Census", "US Census"), values=c("black","blue")) +
scale_linetype_manual(breaks=c("Chinese", "Japanese"), values=c(1,3)) +
labs(x = "Year of Immigration", y = "Inflow of Chinese Immigrants", linetype = "Data Source", color = "Immigrant Group") + theme_minimal() + theme(legend.position='bottom')
fig3_us_can
nrow(reg_chi)
