occ1 == "Forestry and lumbering" | occ1 == "Mining" | occ1 == "Fisheries and hunting" | str_starts(occ1, "Domestic")~ "Unskilled",
str_starts(occ1, "Manufactures") | occ1 == "Trade and Merchandising" | occ1 == "Transportation" | occ1 == "Building trades" ~ "Skilled",
occ1 == "Civil and municipal service" | occ1 == "Professional pursuits" ~ "Skilled"),
RURAL = ifelse(str_detect(CCRI_URBAN_RURAL_1911,"Rural"), 1, 0),
PROVINCE = str_trim(PR_1911),
HOUSEOWN = ifelse(AGE >= 18, ifelse(RELATIONSHIP == "Head", 1, 0), NA)) %>%
select(c(WEIGHT, MALE, AGE, MAR, CANREAD, BPL, OCC, OCCGRP, EARN, YRIMM, IMM, LABOR, RURAL, PROVINCE, HOUSEOWN)) %>%
mutate(YEAR = 1911)
## 1921 Census ----
clean1921 <- bpl1921_long %>% rename(AGE = Derived_Age_In_Years, MARST = MARITAL_STATUS, YRIMM = YEAR_OF_IMMIGRATION,
CANREAD = CAN_READ_INDICATOR, OCC = CHIEFOCCUP, FIRSTNAME = FIRST_NAME, LASTNAME = LAST_NAME, PROVINCE = Province) %>%
mutate(MALE = case_when(SEX == "Male" ~ 1,
SEX == "Female" ~ 0,
TRUE ~ NA_real_),
EARN = ifelse(AGE >= 18 & MALE == 1, ifelse(grepl("[0-9]+", ANNUAL_EARNING_AMOUNT), suppressWarnings(as.numeric(as.character(ANNUAL_EARNING_AMOUNT))), NA_real_), NA),
MAR = case_when(AGE < 18 ~ NA_real_,
MARST == "Married" ~ 1,
MARST == "Single" | MARST == "Widowed" | MARST == "Divorced" ~ 0,
TRUE ~ NA_real_),
CANREAD = case_when(AGE < 18 ~ NA_real_,
CANREAD == "Yes" ~ 1,
CANREAD == "No" ~ 0,
TRUE ~ NA_real_),
YRIMM = ifelse(grepl("[0-9]+", YRIMM), suppressWarnings(as.numeric(as.character(YRIMM))), NA_real_),
IMM = ifelse(BPL == "Canada", 0, 1),
OCC = str_to_lower(OCC),
LABOR = ifelse(AGE >= 18 & MALE == 1, ifelse(str_detect(OCC, "labor") | str_detect(OCC, "labour"), 1, 0), NA),
OCCGRP = case_when(str_detect(CHIEF_OCCUPATION, "Farm") ~ "Farmer",
str_detect(CHIEF_OCCUPATION, "Labor") | str_detect(CHIEF_OCCUPATION, "labor") ~ "Laborer",
str_detect(CHIEF_OCCUPATION, "Mine") | CHIEF_OCCUPATION == "Private household workers (n.e.c.)" | str_detect(CHIEF_OCCUPATION, "Lumbermen") | CHIEF_OCCUPATION == "Carpenters" | CHIEF_OCCUPATION == "Housekeepers, private household" | CHIEF_OCCUPATION == "Fishermen and oystermen" ~ "Unskilled",
str_detect(CHIEF_OCCUPATION, "home") | (str_detect(CHIEF_OCCUPATION, "house") & !str_detect(CHIEF_OCCUPATION, "except")) ~ "Unskilled",
CHIEF_OCCUPATION != "Blank" & CHIEF_OCCUPATION != "Unemployed/ without occupation" & CHIEF_OCCUPATION != "Illegible_duplicated_99999003" ~ "Skilled",
TRUE ~ NA_character_),
HOUSEOWN = ifelse(AGE >= 18, ifelse(str_detect(HOME_OWNED_OR_RENTED, "Owned"), 1, 0), NA),
RURAL = ifelse(str_detect(CCRI_URBAN_RURAL_1921,"Rural"), 1, 0),) %>%
select(c(MALE, AGE, MAR, CANREAD, BPL, OCC, OCCGRP, EARN, YRIMM, WEIGHT, IMM, LABOR, PROVINCE, RURAL, HOUSEOWN)) %>%
mutate(YEAR = 1921)
## Combining Censuses and Outputting ----
clean_all <- bind_rows(clean1901, clean1911) %>%
bind_rows(clean1921) %>%
mutate(AGE = ifelse(AGE > 200, NA, AGE),
YRIMM = ifelse(YRIMM < 1500 | YRIMM > YEAR, NA, YRIMM),
IDNUM = row_number())
clean_imm <- clean_all %>%
filter(IMM == 1)
write_csv(clean_all, glue("{dbox}/cleaned/can_clean.csv"))
write_csv(clean_imm, glue("{dbox}/cleaned/can_clean_imm.csv"))
## Precomputing summary stats for all of canada ----
can_all_summ <- summstats(clean_all %>% mutate(source = "CA Census", group = "All", WEIGHT = 1), c("MALE", "MAR", "AGE", "CANREAD", "LABOR", "EARN"))
write_csv(can_all_summ, glue("{dbox}/cleaned/can_all_summ.csv"))
reg_chi <- read_csv(glue("{dbox}/cleaned/chireg.csv")) %>%
mutate(source = "xRegister", group = "Chinese Immigrants", WEIGHT = 1, YRIMM = YEAR,
tax = case_when(YRIMM <= 1885 ~ 0,
YRIMM <= 1900 ~ 1496.19,
YRIMM <= 1903 ~ 2992.61,
YRIMM < 1924 ~ 14115.70))
# CA census
can_imm <- read_csv(glue("{dbox}/cleaned/can_clean_imm.csv")) %>%
mutate(source = "CA Census", group = "All Immigrants",
tax = case_when(YRIMM <= 1885 ~ 0,
YRIMM <= 1900 ~ 1496.19,
YRIMM <= 1903 ~ 2992.61,
YRIMM < 1924 ~ 14115.70))
varlist_reg = c("MALE", "PRE1886", "YRIMM18861895", "YRIMM18961905", "YRIMM19061915", "POST1916",
"UNDER18","AGE1825","AGE2535","AGE35PLUS", "LABOR", "HEIGHT")
reg_chi_summ <- reg_chi %>% mutate(LABOR = ifelse(AGE < 18, NA, LABOR)*100,
UNDER18 = ifelse(AGE < 18, 1, 0)*100,
AGE1825 = ifelse(AGE >= 18 & AGE < 25, 1, 0)*100,
AGE2535 = ifelse(AGE >= 25 & AGE < 35, 1, 0)*100,
AGE35PLUS = ifelse(AGE >= 35, 1, 0)*100,
PRE1886 = ifelse(YRIMM < 1886, 1, 0)*100,
YRIMM18861895 = ifelse(YRIMM >= 1886 & YRIMM < 1896, 1, 0)*100,
YRIMM18961905 = ifelse(YRIMM >= 1896 & YRIMM < 1906, 1, 0)*100,
YRIMM19061915 = ifelse(YRIMM >= 1906 & YRIMM < 1916, 1, 0)*100,
POST1916 = ifelse(YRIMM >= 1916, 1, 0)*100,
MALE = MALE*100) %>%
filter(YRIMM >= 1886 & YRIMM <= 1923)
## Canadian Census Data ----
# Census variables: sex, year of imm, age at imm, marital status, literacy, laborer status, earnings
varlist_cen <- c("MALE", "MAR", "PRE1886", "YRIMM18861895", "YRIMM18961905", "YRIMM19061915", "POST1916",
"UNDER18","AGE1825","AGE2535","AGE35PLUS", "CANREAD", "LABOR", "EARN")
can_imm_summ <- can_imm %>% mutate(AGEATIMM = AGE - (YEAR-YRIMM),
UNDER18 = ifelse(AGEATIMM < 18, 1, 0)*100,
AGE1825 = ifelse(AGEATIMM >= 18 & AGEATIMM < 25, 1, 0)*100,
AGE2535 = ifelse(AGEATIMM >= 25 & AGEATIMM < 35, 1, 0)*100,
AGE35PLUS = ifelse(AGEATIMM >= 35, 1, 0)*100,
PRE1886 = ifelse(YRIMM < 1886, 1, 0)*100,
YRIMM18861895 = ifelse(YRIMM >= 1886 & YRIMM < 1896, 1, 0)*100,
YRIMM18961905 = ifelse(YRIMM >= 1896 & YRIMM < 1906, 1, 0)*100,
YRIMM19061915 = ifelse(YRIMM >= 1906 & YRIMM < 1916, 1, 0)*100,
POST1916 = ifelse(YRIMM >= 1916, 1, 0)*100,
LABOR = LABOR*100,
CANREAD = CANREAD*100,
MALE = MALE*100,
MAR = MAR*100)
## Summarizing and binding by group ----
summ_stats_df <- bind_rows(summstats(can_imm_summ, varlist_cen),
summstats(can_imm_summ %>% filter(BPL == "Japan"), varlist_cen),
summstats(can_imm_summ %>% filter(BPL == "China"), varlist_cen),
summstats(reg_chi_summ %>% filter(FEES != 0), varlist_reg),
summstats(reg_chi_summ %>% filter(FEES == 0), varlist_reg)) %>%
select(c(-OBS, OBS)) %>%
arrange(across(c(group, source)))
summ_stats_out <- t(summ_stats_df) %>% as.data.frame()
## Writing to table ----
# variable names for table
summ_cats <- c("\\% Male", "\\% Married*", "Year of Immigration (\\%)", "\\;\\; Before 1886",
"\\;\\; 1886-1895", "\\;\\; 1896-1905", "\\;\\; 1906-1915", "\\;\\;After 1916",
"Age at Immigration (\\%)", "\\;\\; Under 18", "\\;\\; 18-24","\\;\\; 25-34",
"\\;\\; Over 35", "\\% Literate*", "\\% Laborers**", "Mean Annual Earnings*", "Height (cm)**")
# opening table connection
summtex <- file(glue("{tabs}/summstats.tex"), open = "w")
# writing table header
writeLines(c("\\begin{tabular}{lcccccc}",
"\\hhline{=======}",
"& \\multicolumn{3}{c}{Canadian Census} & & \\multicolumn{2}{c}{Chinese Register} \\\\ ",
"\\hhline{~---~--}", "& (1) & (2) & (3) & & (4) & (5) \\\\ ",
"& All Foreign-Born. & Japanese Imm. & Chinese Imm. & & Head Tax & No Head Tax \\\\ ", " \\hhline{-------}"), summtex)
# iterating through lines
ind = 1
for (i in 1:length(summ_cats)){
# skip category rownames
if(summ_cats[i] == "Age at Immigration (\\%)" | summ_cats[i] == "Year of Immigration (\\%)"){
writeLines(glue_collapse(c(summ_cats[i],rep("&",6), "\\\\")), summtex)
}else{
means <- ifelse(is.na(summ_stats_out[2*ind+1,]) | as.numeric(summ_stats_out[2*ind+1,])==0, "-", formatC(as.numeric(summ_stats_out[2*ind+1,]), digits = 4))
writeLines(c(paste(summ_cats[i], "&", glue_collapse(c(means[1:3],"",means[4:5]), sep = "&", last = ""), "\\\\ ")), summtex)
ind = ind + 1
}
}
obs <- ifelse(is.na(summ_stats_out[2*ind+1,]), "-", formatC(as.numeric(summ_stats_out[2*ind+1,]), format = "d", big.mark = ","))
writeLines(c("Obs.", "&", glue_collapse(c(obs[1:3],"",obs[4:5]), sep = "&", last = ""), "\\\\ "), summtex)
writeLines(c("\\hhline{-------}","\\end{tabular}"), summtex)
close(summtex)
## Writing to table ----
# variable names for table
summ_cats <- c("\\% Male", "\\% Married*", "Year of Immigration (\\%)", "\\;\\; Before 1886",
"\\;\\; 1886-1895", "\\;\\; 1896-1905", "\\;\\; 1906-1915", "\\;\\;After 1916",
"Age at Immigration (\\%)", "\\;\\; Under 18", "\\;\\; 18-24","\\;\\; 25-34",
"\\;\\; Over 35", "\\% Literate*", "\\% Laborers**", "Mean Annual Earnings**", "Height (cm)**")
# opening table connection
summtex <- file(glue("{tabs}/summstats.tex"), open = "w")
# writing table header
writeLines(c("\\begin{tabular}{lcccccc}",
"\\hhline{=======}",
"& \\multicolumn{3}{c}{Canadian Census} & & \\multicolumn{2}{c}{Chinese Register} \\\\ ",
"\\hhline{~---~--}", "& (1) & (2) & (3) & & (4) & (5) \\\\ ",
"& All Foreign-Born. & Japanese Imm. & Chinese Imm. & & Head Tax & No Head Tax \\\\ ", " \\hhline{-------}"), summtex)
# iterating through lines
ind = 1
for (i in 1:length(summ_cats)){
# skip category rownames
if(summ_cats[i] == "Age at Immigration (\\%)" | summ_cats[i] == "Year of Immigration (\\%)"){
writeLines(glue_collapse(c(summ_cats[i],rep("&",6), "\\\\")), summtex)
}else{
means <- ifelse(is.na(summ_stats_out[2*ind+1,]) | as.numeric(summ_stats_out[2*ind+1,])==0, "-", formatC(as.numeric(summ_stats_out[2*ind+1,]), digits = 4))
writeLines(c(paste(summ_cats[i], "&", glue_collapse(c(means[1:3],"",means[4:5]), sep = "&", last = ""), "\\\\ ")), summtex)
ind = ind + 1
}
}
obs <- ifelse(is.na(summ_stats_out[2*ind+1,]), "-", formatC(as.numeric(summ_stats_out[2*ind+1,]), format = "d", big.mark = ","))
writeLines(c("Obs.", "&", glue_collapse(c(obs[1:3],"",obs[4:5]), sep = "&", last = ""), "\\\\ "), summtex)
writeLines(c("\\hhline{-------}","\\end{tabular}"), summtex)
close(summtex)
844/2
reg_chi <- read_csv(glue("{dbox}/cleaned/chireg.csv")) %>%
mutate(source = "xRegister", group = "Chinese Immigrants", WEIGHT = 1, YRIMM = YEAR,
WHIPPLE = ifelse(AGE %% 5 == 0, 1, 0),
tax = case_when(YRIMM <= 1885 ~ 0,
YRIMM <= 1900 ~ 1496.19,
YRIMM <= 1903 ~ 2992.61,
YRIMM < 1924 ~ 14115.70))
# CA census
can_imm <- read_csv(glue("{dbox}/cleaned/can_clean_imm.csv")) %>%
mutate(source = "CA Census", group = "All Immigrants",
WHIPPLE = ifelse(AGE %% 5 == 0, 1, 0),
tax = case_when(YRIMM <= 1885 ~ 0,
YRIMM <= 1900 ~ 1496.19,
YRIMM <= 1903 ~ 2992.61,
YRIMM < 1924 ~ 14115.70))
varlist_reg = c("MALE", "PRE1886", "YRIMM18861895", "YRIMM18961905", "YRIMM19061915", "POST1916",
"UNDER18","AGE1825","AGE2535","AGE35PLUS","WHIPPLE","LABOR", "HEIGHT")
reg_chi_summ <- reg_chi %>% mutate(LABOR = ifelse(AGE < 18, NA, LABOR)*100,
UNDER18 = ifelse(AGE < 18, 1, 0)*100,
AGE1825 = ifelse(AGE >= 18 & AGE < 25, 1, 0)*100,
AGE2535 = ifelse(AGE >= 25 & AGE < 35, 1, 0)*100,
AGE35PLUS = ifelse(AGE >= 35, 1, 0)*100,
PRE1886 = ifelse(YRIMM < 1886, 1, 0)*100,
YRIMM18861895 = ifelse(YRIMM >= 1886 & YRIMM < 1896, 1, 0)*100,
YRIMM18961905 = ifelse(YRIMM >= 1896 & YRIMM < 1906, 1, 0)*100,
YRIMM19061915 = ifelse(YRIMM >= 1906 & YRIMM < 1916, 1, 0)*100,
POST1916 = ifelse(YRIMM >= 1916, 1, 0)*100,
MALE = MALE*100) %>%
filter(YRIMM >= 1886 & YRIMM <= 1923)
## Canadian Census Data ----
# Census variables: sex, year of imm, age at imm, marital status, literacy, laborer status, earnings
varlist_cen <- c("MALE", "MAR", "PRE1886", "YRIMM18861895", "YRIMM18961905", "YRIMM19061915", "POST1916",
"UNDER18","AGE1825","AGE2535","AGE35PLUS", "CANREAD", "WHIPPLE", "LABOR", "EARN")
can_imm_summ <- can_imm %>% mutate(AGEATIMM = AGE - (YEAR-YRIMM),
UNDER18 = ifelse(AGEATIMM < 18, 1, 0)*100,
AGE1825 = ifelse(AGEATIMM >= 18 & AGEATIMM < 25, 1, 0)*100,
AGE2535 = ifelse(AGEATIMM >= 25 & AGEATIMM < 35, 1, 0)*100,
AGE35PLUS = ifelse(AGEATIMM >= 35, 1, 0)*100,
PRE1886 = ifelse(YRIMM < 1886, 1, 0)*100,
YRIMM18861895 = ifelse(YRIMM >= 1886 & YRIMM < 1896, 1, 0)*100,
YRIMM18961905 = ifelse(YRIMM >= 1896 & YRIMM < 1906, 1, 0)*100,
YRIMM19061915 = ifelse(YRIMM >= 1906 & YRIMM < 1916, 1, 0)*100,
POST1916 = ifelse(YRIMM >= 1916, 1, 0)*100,
LABOR = LABOR*100,
CANREAD = CANREAD*100,
MALE = MALE*100,
MAR = MAR*100)
## Summarizing and binding by group ----
summ_stats_df <- bind_rows(summstats(can_imm_summ, varlist_cen),
summstats(can_imm_summ %>% filter(BPL == "Japan"), varlist_cen),
summstats(can_imm_summ %>% filter(BPL == "China"), varlist_cen),
summstats(reg_chi_summ %>% filter(FEES != 0), varlist_reg),
summstats(reg_chi_summ %>% filter(FEES == 0), varlist_reg)) %>%
select(c(-OBS, OBS)) %>%
arrange(across(c(group, source)))
summ_stats_out <- t(summ_stats_df) %>% as.data.frame()
reg_chi <- read_csv(glue("{dbox}/cleaned/chireg.csv")) %>%
mutate(source = "xRegister", group = "Chinese Immigrants", WEIGHT = 1, YRIMM = YEAR,
WHIPPLE = ifelse(AGE >= 18, 500*ifelse(AGE %% 5 == 0, 1, 0), NA),
tax = case_when(YRIMM <= 1885 ~ 0,
YRIMM <= 1900 ~ 1496.19,
YRIMM <= 1903 ~ 2992.61,
YRIMM < 1924 ~ 14115.70))
# CA census
can_imm <- read_csv(glue("{dbox}/cleaned/can_clean_imm.csv")) %>%
mutate(source = "CA Census", group = "All Immigrants",
WHIPPLE = ifelse(AGE >= 18, 500*ifelse(AGE %% 5 == 0, 1, 0), NA),
tax = case_when(YRIMM <= 1885 ~ 0,
YRIMM <= 1900 ~ 1496.19,
YRIMM <= 1903 ~ 2992.61,
YRIMM < 1924 ~ 14115.70))
varlist_reg = c("MALE", "PRE1886", "YRIMM18861895", "YRIMM18961905", "YRIMM19061915", "POST1916",
"UNDER18","AGE1825","AGE2535","AGE35PLUS","WHIPPLE","LABOR", "HEIGHT")
reg_chi_summ <- reg_chi %>% mutate(LABOR = ifelse(AGE < 18, NA, LABOR)*100,
UNDER18 = ifelse(AGE < 18, 1, 0)*100,
AGE1825 = ifelse(AGE >= 18 & AGE < 25, 1, 0)*100,
AGE2535 = ifelse(AGE >= 25 & AGE < 35, 1, 0)*100,
AGE35PLUS = ifelse(AGE >= 35, 1, 0)*100,
PRE1886 = ifelse(YRIMM < 1886, 1, 0)*100,
YRIMM18861895 = ifelse(YRIMM >= 1886 & YRIMM < 1896, 1, 0)*100,
YRIMM18961905 = ifelse(YRIMM >= 1896 & YRIMM < 1906, 1, 0)*100,
YRIMM19061915 = ifelse(YRIMM >= 1906 & YRIMM < 1916, 1, 0)*100,
POST1916 = ifelse(YRIMM >= 1916, 1, 0)*100,
MALE = MALE*100) %>%
filter(YRIMM >= 1886 & YRIMM <= 1923)
## Canadian Census Data ----
# Census variables: sex, year of imm, age at imm, marital status, literacy, laborer status, earnings
varlist_cen <- c("MALE", "MAR", "PRE1886", "YRIMM18861895", "YRIMM18961905", "YRIMM19061915", "POST1916",
"UNDER18","AGE1825","AGE2535","AGE35PLUS", "CANREAD", "WHIPPLE", "LABOR", "EARN")
can_imm_summ <- can_imm %>% mutate(AGEATIMM = AGE - (YEAR-YRIMM),
UNDER18 = ifelse(AGEATIMM < 18, 1, 0)*100,
AGE1825 = ifelse(AGEATIMM >= 18 & AGEATIMM < 25, 1, 0)*100,
AGE2535 = ifelse(AGEATIMM >= 25 & AGEATIMM < 35, 1, 0)*100,
AGE35PLUS = ifelse(AGEATIMM >= 35, 1, 0)*100,
PRE1886 = ifelse(YRIMM < 1886, 1, 0)*100,
YRIMM18861895 = ifelse(YRIMM >= 1886 & YRIMM < 1896, 1, 0)*100,
YRIMM18961905 = ifelse(YRIMM >= 1896 & YRIMM < 1906, 1, 0)*100,
YRIMM19061915 = ifelse(YRIMM >= 1906 & YRIMM < 1916, 1, 0)*100,
POST1916 = ifelse(YRIMM >= 1916, 1, 0)*100,
LABOR = LABOR*100,
CANREAD = CANREAD*100,
MALE = MALE*100,
MAR = MAR*100)
## Summarizing and binding by group ----
summ_stats_df <- bind_rows(summstats(can_imm_summ, varlist_cen),
summstats(can_imm_summ %>% filter(BPL == "Japan"), varlist_cen),
summstats(can_imm_summ %>% filter(BPL == "China"), varlist_cen),
summstats(reg_chi_summ %>% filter(FEES != 0), varlist_reg),
summstats(reg_chi_summ %>% filter(FEES == 0), varlist_reg)) %>%
select(c(-OBS, OBS)) %>%
arrange(across(c(group, source)))
summ_stats_out <- t(summ_stats_df) %>% as.data.frame()
## Writing to table ----
# variable names for table
summ_cats <- c("\\% Male", "\\% Married*", "Year of Immigration (\\%)", "\\;\\; Before 1886",
"\\;\\; 1886-1895", "\\;\\; 1896-1905", "\\;\\; 1906-1915", "\\;\\;After 1916",
"Age at Immigration (\\%)", "\\;\\; Under 18", "\\;\\; 18-24","\\;\\; 25-34",
"\\;\\; Over 35", "\\% Literate*", "Whipple Index", "\\% Laborers**", "Mean Annual Earnings**", "Height (cm)**")
# opening table connection
summtex <- file(glue("{tabs}/summstats.tex"), open = "w")
# writing table header
writeLines(c("\\begin{tabular}{lcccccc}",
"\\hhline{=======}",
"& \\multicolumn{3}{c}{Canadian Census} & & \\multicolumn{2}{c}{Chinese Register} \\\\ ",
"\\hhline{~---~--}", "& (1) & (2) & (3) & & (4) & (5) \\\\ ",
"& All Foreign-Born. & Japanese Imm. & Chinese Imm. & & Head Tax & No Head Tax \\\\ ", " \\hhline{-------}"), summtex)
# iterating through lines
ind = 1
for (i in 1:length(summ_cats)){
# skip category rownames
if(summ_cats[i] == "Age at Immigration (\\%)" | summ_cats[i] == "Year of Immigration (\\%)"){
writeLines(glue_collapse(c(summ_cats[i],rep("&",6), "\\\\")), summtex)
}else{
means <- ifelse(is.na(summ_stats_out[2*ind+1,]) | as.numeric(summ_stats_out[2*ind+1,])==0, "-", formatC(as.numeric(summ_stats_out[2*ind+1,]), digits = 4))
writeLines(c(paste(summ_cats[i], "&", glue_collapse(c(means[1:3],"",means[4:5]), sep = "&", last = ""), "\\\\ ")), summtex)
ind = ind + 1
}
}
obs <- ifelse(is.na(summ_stats_out[2*ind+1,]), "-", formatC(as.numeric(summ_stats_out[2*ind+1,]), format = "d", big.mark = ","))
writeLines(c("Obs.", "&", glue_collapse(c(obs[1:3],"",obs[4:5]), sep = "&", last = ""), "\\\\ "), summtex)
writeLines(c("\\hhline{-------}","\\end{tabular}"), summtex)
close(summtex)
reg_chi_whipple <- reg_chi %>% filter(YRIMM >= 1886 & YRIMM <= 1923 & AGE >= 18 & AGE <= 57) %>%
group_by(YRIMM) %>%
summarize(whipple = 500*sum(ifelse(AGE %% 5 == 0, 1, 0))/n(), n = n(),
pred_whipple = mean(pred_whipple_AUSYD, na.rm=TRUE))
reg_chi <- read_csv(glue("{dbox}/cleaned/chireg.csv")) %>%
mutate(source = "xRegister", group = "Chinese Immigrants", WEIGHT = 1, YRIMM = YEAR, YRIMM_FISCAL = FISCALYEAR,
tax = case_when(YRIMM <= 1885 ~ 0,
YRIMM <= 1900 ~ 1496.19,
YRIMM <= 1903 ~ 2992.61,
YRIMM < 1924 ~ 14115.70),
arr_cohort = case_when(YRIMM >= 1886 & YRIMM < 1890 ~ "1886-1889",
YRIMM >= 1890 & YRIMM < 1895 ~ "1890-1894",
YRIMM >= 1895 & YRIMM < 1900 ~ "1895-1899",
YRIMM >= 1900 & YRIMM < 1904 ~ "1900-1903",
YRIMM >= 1904 & YRIMM < 1910 ~ "1904-1909",
YRIMM >= 1910 & YRIMM < 1915 ~ "1910-1914",
TRUE ~ NA_character_),
BIRTHYR = ifelse(REG_Year != 0, REG_Year - AGE, NA),
birthcohort = cut(BIRTHYR, breaks = c(1850, 1860, 1870, 1880, 1890)),
HEIGHT = HEIGHT * 2.54,
pred_height_AUNT = case_when(BIRTHYR < 1850 ~ 164.2,
BIRTHYR < 1855 ~ 164,
BIRTHYR < 1860 ~ 163.8,
BIRTHYR < 1865 ~ 163.9,
BIRTHYR < 1870 ~ 163.9,
BIRTHYR < 1875 ~ 163.6,
BIRTHYR < 1880 ~ 163.3,
BIRTHYR < 1885 ~ 162.8,
BIRTHYR < 1890 ~ 162,
BIRTHYR < 1895 ~ 162.1,
BIRTHYR < 1900 ~ 162.1,
BIRTHYR < 1905 ~ 162.4,
BIRTHYR < 1910 ~ 162.9,
TRUE ~ NA),
pred_whipple_AUSYD = case_when(BIRTHYR < 1850 ~ 197,
BIRTHYR < 1860 ~ 139,
BIRTHYR < 1870 ~ 134,
BIRTHYR < 1880 ~ 122,
BIRTHYR < 1890 ~ 100,
BIRTHYR < 1910 ~ 100,
TRUE ~ NA))
reg_chi <- read_csv(glue("{dbox}/cleaned/chireg.csv")) %>%
mutate(source = "xRegister", group = "Chinese Immigrants", WEIGHT = 1, YRIMM = YEAR,
tax = case_when(YRIMM <= 1885 ~ 0,
YRIMM <= 1900 ~ 1496.19,
YRIMM <= 1903 ~ 2992.61,
YRIMM < 1924 ~ 14115.70),
arr_cohort = case_when(YRIMM >= 1886 & YRIMM < 1890 ~ "1886-1889",
YRIMM >= 1890 & YRIMM < 1895 ~ "1890-1894",
YRIMM >= 1895 & YRIMM < 1900 ~ "1895-1899",
YRIMM >= 1900 & YRIMM < 1904 ~ "1900-1903",
YRIMM >= 1904 & YRIMM < 1910 ~ "1904-1909",
YRIMM >= 1910 & YRIMM < 1915 ~ "1910-1914",
TRUE ~ NA_character_),
BIRTHYR = ifelse(REG_Year != 0, REG_Year - AGE, NA),
birthcohort = cut(BIRTHYR, breaks = c(1850, 1860, 1870, 1880, 1890)),
HEIGHT = HEIGHT * 2.54,
pred_height_AUNT = case_when(BIRTHYR < 1850 ~ 164.2,
BIRTHYR < 1855 ~ 164,
BIRTHYR < 1860 ~ 163.8,
BIRTHYR < 1865 ~ 163.9,
BIRTHYR < 1870 ~ 163.9,
BIRTHYR < 1875 ~ 163.6,
BIRTHYR < 1880 ~ 163.3,
BIRTHYR < 1885 ~ 162.8,
BIRTHYR < 1890 ~ 162,
BIRTHYR < 1895 ~ 162.1,
BIRTHYR < 1900 ~ 162.1,
BIRTHYR < 1905 ~ 162.4,
BIRTHYR < 1910 ~ 162.9,
TRUE ~ NA),
pred_whipple_AUSYD = case_when(BIRTHYR < 1850 ~ 197,
BIRTHYR < 1860 ~ 139,
BIRTHYR < 1870 ~ 134,
BIRTHYR < 1880 ~ 122,
BIRTHYR < 1890 ~ 100,
BIRTHYR < 1910 ~ 100,
TRUE ~ NA))
reg_chi_whipple <- reg_chi %>% filter(YRIMM >= 1886 & YRIMM <= 1923 & AGE >= 18 & AGE <= 57) %>%
group_by(YRIMM) %>%
summarize(whipple = 500*sum(ifelse(AGE %% 5 == 0, 1, 0))/n(), n = n(),
pred_whipple = mean(pred_whipple_AUSYD, na.rm=TRUE))
ggplot(reg_chi_whipple, aes(x = YRIMM, y = whipple)) + geom_smooth(method = "lm", aes(weight = n)) + geom_point(aes(size = n))
ggplot(reg_chi_whipple %>% pivot_longer(cols = c(whipple, pred_whipple), values_to = "whp", names_to = "cat"),
aes(x = YRIMM, y = whp, color = cat)) + geom_smooth(method = "lm", aes(weight = n)) + geom_point(aes(size = n))
can_imm %>% group_by(YEAR) %>% summarize(read = weighted.mean(CANREAD,WEIGHT))
can_imm %>% group_by(YEAR) %>% summarize(read = weighted.mean(CANREAD,WEIGHT, na.rm=TRUE))
can_imm %>% group_by(YEAR) %>% summarize(read = weighted.mean(HOUSEOWN,WEIGHT, na.rm=TRUE))
clean1921 <- bpl1921_long %>% rename(AGE = Derived_Age_In_Years, MARST = MARITAL_STATUS, YRIMM = YEAR_OF_IMMIGRATION,
CANREAD = CAN_READ_INDICATOR, OCC = CHIEFOCCUP, FIRSTNAME = FIRST_NAME, LASTNAME = LAST_NAME, PROVINCE = Province) %>%
mutate(MALE = case_when(SEX == "Male" ~ 1,
SEX == "Female" ~ 0,
TRUE ~ NA_real_),
EARN = ifelse(AGE >= 18 & MALE == 1, ifelse(grepl("[0-9]+", ANNUAL_EARNING_AMOUNT), suppressWarnings(as.numeric(as.character(ANNUAL_EARNING_AMOUNT))), NA_real_), NA),
MAR = case_when(AGE < 18 ~ NA_real_,
MARST == "Married" ~ 1,
MARST == "Single" | MARST == "Widowed" | MARST == "Divorced" ~ 0,
TRUE ~ NA_real_),
CANREAD = case_when(AGE < 18 ~ NA_real_,
CANREAD == "Yes" ~ 1,
CANREAD == "No" ~ 0,
TRUE ~ NA_real_),
YRIMM = ifelse(grepl("[0-9]+", YRIMM), suppressWarnings(as.numeric(as.character(YRIMM))), NA_real_),
IMM = ifelse(BPL == "Canada", 0, 1),
OCC = str_to_lower(OCC),
LABOR = ifelse(AGE >= 18 & MALE == 1, ifelse(str_detect(OCC, "labor") | str_detect(OCC, "labour"), 1, 0), NA),
OCCGRP = case_when(str_detect(CHIEF_OCCUPATION, "Farm") ~ "Farmer",
str_detect(CHIEF_OCCUPATION, "Labor") | str_detect(CHIEF_OCCUPATION, "labor") ~ "Laborer",
str_detect(CHIEF_OCCUPATION, "Mine") | CHIEF_OCCUPATION == "Private household workers (n.e.c.)" | str_detect(CHIEF_OCCUPATION, "Lumbermen") | CHIEF_OCCUPATION == "Carpenters" | CHIEF_OCCUPATION == "Housekeepers, private household" | CHIEF_OCCUPATION == "Fishermen and oystermen" ~ "Unskilled",
str_detect(CHIEF_OCCUPATION, "home") | (str_detect(CHIEF_OCCUPATION, "house") & !str_detect(CHIEF_OCCUPATION, "except")) ~ "Unskilled",
CHIEF_OCCUPATION != "Blank" & CHIEF_OCCUPATION != "Unemployed/ without occupation" & CHIEF_OCCUPATION != "Illegible_duplicated_99999003" ~ "Skilled",
TRUE ~ NA_character_),
HOUSEOWN = ifelse(AGE >= 18, ifelse(str_detect(HOME_OWNED_OR_RENTED, "Owned"), 1, 0), NA),
RURAL = ifelse(str_detect(CCRI_URBAN_RURAL_1921,"Rural"), 1, 0),) %>%
select(c(MALE, AGE, MAR, CANREAD, BPL, OCC, OCCGRP, EARN, YRIMM, WEIGHT, IMM, LABOR, PROVINCE, RURAL, HOUSEOWN)) %>%
mutate(YEAR = 1921)
clean1921 <- bpl1921_long %>% rename(AGE = Derived_Age_In_Years, MARST = MARITAL_STATUS, YRIMM = YEAR_OF_IMMIGRATION,
CANREAD = CAN_READ_INDICATOR, OCC = CHIEFOCCUP, FIRSTNAME = FIRST_NAME, LASTNAME = LAST_NAME, PROVINCE = Province) %>%
mutate(MALE = case_when(SEX == "Male" ~ 1,
SEX == "Female" ~ 0,
TRUE ~ NA_real_),
EARN = ifelse(AGE >= 18 & MALE == 1, ifelse(grepl("[0-9]+", ANNUAL_EARNING_AMOUNT), suppressWarnings(as.numeric(as.character(ANNUAL_EARNING_AMOUNT))), NA_real_), NA),
MAR = case_when(AGE < 18 ~ NA_real_,
MARST == "Married" ~ 1,
MARST == "Single" | MARST == "Widowed" | MARST == "Divorced" ~ 0,
TRUE ~ NA_real_),
CANREAD = case_when(AGE < 18 ~ NA_real_,
CANREAD == "Yes" ~ 1,
CANREAD == "No" ~ 0,
TRUE ~ NA_real_),
YRIMM = ifelse(grepl("[0-9]+", YRIMM), suppressWarnings(as.numeric(as.character(YRIMM))), NA_real_),
IMM = ifelse(BPL == "Canada", 0, 1),
OCC = str_to_lower(OCC),
LABOR = ifelse(AGE >= 18 & MALE == 1, ifelse(str_detect(OCC, "labor") | str_detect(OCC, "labour"), 1, 0), NA),
OCCGRP = case_when(str_detect(CHIEF_OCCUPATION, "Farm") ~ "Farmer",
str_detect(CHIEF_OCCUPATION, "Labor") | str_detect(CHIEF_OCCUPATION, "labor") ~ "Laborer",
str_detect(CHIEF_OCCUPATION, "Mine") | CHIEF_OCCUPATION == "Private household workers (n.e.c.)" | str_detect(CHIEF_OCCUPATION, "Lumbermen") | CHIEF_OCCUPATION == "Carpenters" | CHIEF_OCCUPATION == "Housekeepers, private household" | CHIEF_OCCUPATION == "Fishermen and oystermen" ~ "Unskilled",
str_detect(CHIEF_OCCUPATION, "home") | (str_detect(CHIEF_OCCUPATION, "house") & !str_detect(CHIEF_OCCUPATION, "except")) ~ "Unskilled",
CHIEF_OCCUPATION != "Blank" & CHIEF_OCCUPATION != "Unemployed/ without occupation" & CHIEF_OCCUPATION != "Illegible_duplicated_99999003" ~ "Skilled",
TRUE ~ NA_character_),
HOUSEOWN = ifelse(AGE >= 18, ifelse(str_detect(HOME_OWNED_OR_RENTED, "Owned"), 1, 0), NA),
HOUSEOWN2 = ifelse(AGE >= 18, ifelse(RELATIONSHIP == "Head", 1, 0), NA),
RURAL = ifelse(str_detect(CCRI_URBAN_RURAL_1921,"Rural"), 1, 0))
table(clean1921$HOUSEOWN, clean1921$HOUSEOWN2)
clean1921 %>% group_by(HOUSEOWN, HOUSEOWN2) %>% summarize(n=sum(WEIGHT))
table(bpl1901_long$earnings) %>% View()
census_whipple <- can_imm %>% filter(YRIMM >= 1880 & YRIMM <= 1923 & !is.na(AGE) & AGE >= 23 & AGE <= 62 &
BPL %in% c("China","Japan")) %>%
group_by(BPL, YRIMM) %>% summarize(whipple = 500*sum(ifelse(AGE %% 5 == 0, WEIGHT, 0))/sum(WEIGHT), n = sum(WEIGHT))
ggplot(census_whipple %>% filter(BPL == "China"), aes(x = YRIMM, y = whipple)) + geom_smooth(method = "lm", aes(weight = n)) + geom_point(aes(size = n))
ggplot(census_whipple, aes(x = YRIMM, y = whipple, color = factor(BPL))) + geom_smooth(method = "lm", aes(weight = n)) + geom_point(aes(size = n))
ggplot(reg_chi_whipple %>% pivot_longer(cols = c(whipple, pred_whipple), values_to = "whp", names_to = "cat"),
aes(x = YRIMM, y = whp, color = cat)) + geom_smooth(method = "lm", aes(weight = n)) + geom_point(aes(size = n))
can_imm %>% filter(YRIMM >= 1880 & YRIMM <= 1923 & !is.na(AGE) & AGE >= 23 & AGE <= 62 &
BPL %in% c("China","Japan")) %>%
group_by(BPL, YEAR) %>% summarize(whipple = 500*sum(ifelse(AGE %% 5 == 0, WEIGHT, 0))/sum(WEIGHT), n = sum(WEIGHT))
can_imm %>% filter(YRIMM >= 1880 & YRIMM <= 1923 & !is.na(AGE) & AGE >= 23 & AGE <= 62 ) %>%
group_by(YEAR) %>% summarize(whipple = 500*sum(ifelse(AGE %% 5 == 0, WEIGHT, 0))/sum(WEIGHT), n = sum(WEIGHT))
can_imm %>% group_by(YEAR) %>% summarize(LABOR = mean(LABOR,na.rm=TRUE))
can_imm %>% group_by(YEAR) %>% summarize(LABOR = weighted.mean(LABOR,WEIGHT,na.rm=TRUE))
can_imm %>% group_by(YEAR) %>% filter(BPL == "China") %>% summarize(LABOR = weighted.mean(LABOR,WEIGHT,na.rm=TRUE))
ipumsi <- read_csv(glue("{dbox}/raw/can_census_ipumsi.csv"))
## cleaned
clean_all <- read_csv(glue("{dbox}/cleaned/clean_all.csv"))
clean_all <- read_csv(glue("{dbox}/cleaned/can_clean.csv"))
clean_all <- read_csv(glue("{dbox}/cleaned/can_clean.csv")) %>%
filter(YEAR %in% c(1901, 1911))
## raw
raw1901 <- read.spss(glue("{dbox}/raw/census1901.sav")) %>% as.data.frame() # 5% sample
raw1911 <- read.spss(glue("{dbox}/raw/census1911.sav")) %>% as.data.frame() # 5% sample
# COMPARING DATASETS ----
## Counts and Weights ----
nrow(ipumsi)
nrow(clean_all)
ipumsi %>% group_by(YEAR) %>% summarize(n = n(), pop = sum(PERWT))
clean_all <- read_csv(glue("{dbox}/cleaned/can_clean.csv")) %>%
filter(YEAR %in% c(1901, 1911))
clean_all %>% group_by(YEAR) %>% summarize(n = n(), pop = sum(WEIGHT))
names(ipumsi)
View(ipumsi)
raw_all <- bind_rows(raw1901 %>% mutate(YEAR = 1901), raw1911 %>% mutate(YEAR = 1911))
raw_all <- bind_rows(raw1901 %>% mutate(YEAR = 1901), raw1911 %>% mutate(YEAR = 1911)) %>%
mutate(WEIGHT = 20)
ipumsi %>% group_by(YEAR) %>% summarize(n = n(), pop = sum(PERWT))
clean_all %>% group_by(YEAR) %>% summarize(n = n(), pop = sum(WEIGHT))
raw_all %>% group_by(YEAR) %>% summarize(n = n(), pop = sum(WEIGHT))
View(raw1901)
View(raw1901)\
View(raw1911)
warnings()
ipumsi %>% group_by(YEAR) %>% summarize(n = n(), pop = sum(PERWT))
clean_all %>% group_by(YEAR) %>% summarize(n = n(), pop = sum(WEIGHT))
raw_all %>% group_by(YEAR) %>% summarize(n = n(), pop = sum(WEIGHT))
table(ipumsi$PERWT)
x <- read.spss("~/Downloads/1901.sav")
nrow(x)
x <- read.spss("~/Downloads/1901.sav") %>% as.data.frame()
nrow(x)
library(foreign)
x <- read_sav("~/Downloads/1901.sav")
library(haven)
x <- read_sav("~/Downloads/1901.sav")
x <- read.spss("~/Downloads/1901.sav", to.data.frame=TRUE)
nrow(x)
install.packages("haven")
