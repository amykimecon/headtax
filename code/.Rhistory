nrow(filter(did_data_us, BORNCHI == 1))
mean(filter(did_data_us, !is.na(LABOR))$LABOR)
sd(filter(did_data_us, !is.na(LABOR))$LABOR)/sqrt(nrow(filter(did_data_us, !is.na(LABOR))))
mean(filter(did_data_us, !is.na(CANREAD))$CANREAD)
sd(filter(did_data_us, !is.na(CANREAD))$CANREAD)/sqrt(nrow(filter(did_data_us, !is.na(CANREAD))))
mean(filter(did_data_us, !is.na(EARN))$EARN)
sd(filter(did_data_us, !is.na(EARN))$EARN)/sqrt(nrow(filter(did_data_us, !is.na(EARN))))
nrow(filter(did_data_us, EARN == 0))
hist(did_data_us$EARN)
max(did_data_us$EARN)
did_data_us <- us_imm %>% filter(YEAR >= 1900 & YRIMM >= 1880 & YRIMM <= 1910) %>% #only keeping years with earnings/yrimm data
mutate(BORNCHI_tax50 = BORNCHI*ifelse(tax == 50, 1, 0),
BORNCHI_tax100 = BORNCHI*ifelse(tax == 100, 1, 0),
BORNCHI_tax500 = BORNCHI*ifelse(tax == 500, 1, 0),
EARN = ifelse(EARN > 100, NA, EARN)) %>%
filter(AGE >= 18 & MALE == 1)
did_data_us <- us_imm %>% filter(YEAR >= 1900 & YRIMM >= 1880 & YRIMM <= 1910) %>% #only keeping years with earnings/yrimm data
mutate(BORNCHI_tax50 = BORNCHI*ifelse(tax == 50, 1, 0),
BORNCHI_tax100 = BORNCHI*ifelse(tax == 100, 1, 0),
BORNCHI_tax500 = BORNCHI*ifelse(tax == 500, 1, 0),
ERSCORE = ifelse(EARN > 100, NA, EARN)) %>%
filter(AGE >= 18 & MALE == 1)
did_reg_earn_us <- lm(ERSCORE ~ factor(YRIMM) + factor(YEAR) + AGE + BORNCHI + BORNCHI_tax50 + BORNCHI_tax100 + BORNCHI_tax500, data = did_data_us)
mean(filter(did_data_us, !is.na(ERSCORE))$ERSCORE)
sd(filter(did_data_us, !is.na(ERSCORE))$ERSCORE)/sqrt(nrow(filter(did_data_us, !is.na(ERSCORE))))
mean(filter(did_data_us, !is.na(HOUSEOWN))$HOUSEOWN)
sd(filter(did_data_us, !is.na(HOUSEOWN))$HOUSEOWN)/sqrt(nrow(filter(did_data_us, !is.na(HOUSEOWN))))
stargazer(did_reg_labor_us, did_reg_canread_us, did_reg_earn_us, did_reg_houseown_us,
out = glue("{git}/figs/8aug23/outcome_regs_us.tex"), float = FALSE,
intercept.bottom =FALSE,
keep = c("BORNCHI*"),
single.row = TRUE,
covariate.labels = c("$BORNCHI$", "$BORNCHI \\times$ \\$50 Tax", "$BORNCHI \\times$ \\$100 Tax", "$BORNCHI \\times$ \\$500 Tax"),
keep.stat=c("n","adj.rsq"),
table.layout = "=cd#-ta-s-",
add.lines = list(c("Dep. Var. Mean (SE)", "0.219 (0.000)", "0.884 (0.000)", "48.3 (0.007)", "0.332 (0.000)")))
?approx
x <- 1:10
y <- rnorm(10)
par(mfrow = c(2,1))
plot(x, y, main = "approx(.) and approxfun(.)")
names(bplwide)
names(bplall)
bpl_interp <- bplall %>% pivot_wider(id_cols = BPL, names_from = BPL, values_from = POP)
bpl_interp <- bplall %>% pivot_wider(id_cols = YEAR, names_from = BPL, values_from = POP)
bpl_interp <- data.frame(YEAR = 1871:1921) %>% left_join(bplall %>% pivot_wider(id_cols = YEAR, names_from = BPL, values_from = POP))
head(bpl_interp)
bpl_interp <- data.frame(YEAR = 1871:1921) %>% left_join(bplall %>% pivot_wider(id_cols = YEAR, names_from = BPL, values_from = POP)) %>%
mutate(across(-YEAR, function(.x) spline(.x, method = "fmm", xout = YEAR)))
View(bpl_interp)
rlang::last_trace()
bpl_interp <- data.frame(YEAR = 1871:1921) %>% left_join(bplall %>% pivot_wider(id_cols = YEAR, names_from = BPL, values_from = POP))
spline(bpl_interp$Denmark, xout = bpl_interp$YEAR)
bpl_interp <- data.frame(YEAR = 1871:1921) %>% left_join(bplall %>% pivot_wider(id_cols = YEAR, names_from = BPL, values_from = POP)) %>%
mutate(across(-YEAR, function(.x) spline(.x, method = "fmm", xout = YEAR)$y))
bpl_interp <- data.frame(YEAR = 1871:1921) %>% left_join(bplall %>% pivot_wider(id_cols = YEAR, names_from = BPL, values_from = POP))
is.numeric(bpl_interp$`Australia and NZ`)
bpl_interp <- data.frame(YEAR = 1871:1921) %>% left_join(bplall %>% pivot_wider(id_cols = YEAR, names_from = BPL, values_from = POP))
approx(bpl_interp$Denmark, xout = bpl_interp$YEAR)
approx(bpl_interp$YEAR, bpl_interp$Denmark, xout = bpl_interp$YEAR)
bpl_interp <- data.frame(YEAR = 1871:1921) %>% left_join(bplall %>% pivot_wider(id_cols = YEAR, names_from = BPL, values_from = POP)) %>%
mutate(across(-YEAR, function(.x) spline(YEAR, .x, method = "fmm", xout = YEAR)$y))
?across
?spline
bpl_interp <- data.frame(YEAR = 1871:1921) %>% left_join(bplall %>% pivot_wider(id_cols = YEAR, names_from = BPL, values_from = POP)) %>%
mutate(across(-YEAR, function(.x) spline(YEAR, .x, method = "fmm", xout = YEAR)$y, .names = "{.col}_spline"),
across(-YEAR, function(.x) approx(YEAR, .x, method = "fmm", xout = YEAR)$y, .names = "{.col}_linear"))
l_interp <- data.frame(YEAR = 1871:1921) %>% left_join(bplall %>% pivot_wider(id_cols = YEAR, names_from = BPL, values_from = POP)) %>%
mutate(across(-YEAR, function(.x) spline(YEAR, .x, method = "fmm", xout = YEAR)$y, .names = "{.col}_spline"),
across(-YEAR, function(.x) approx(YEAR, .x, xout = YEAR)$y, .names = "{.col}_linear"))
bpl_interp <- data.frame(YEAR = 1871:1921) %>% left_join(bplall %>% pivot_wider(id_cols = YEAR, names_from = BPL, values_from = POP)) %>%
mutate(across(-YEAR, function(.x) spline(YEAR, .x, method = "fmm", xout = YEAR)$y, .names = "{.col}_spline"),
across(-YEAR, function(.x) approx(YEAR, .x, xout = YEAR)$y, .names = "{.col}_linear"))
?pivot_longer
bpl_interp <- data.frame(YEAR = 1871:1921) %>% left_join(bplall %>% pivot_wider(id_cols = YEAR, names_from = BPL, values_from = POP)) %>%
mutate(across(-YEAR, function(.x) spline(YEAR, .x, method = "fmm", xout = YEAR)$y, .names = "{.col}_spline"),
across(-YEAR, function(.x) approx(YEAR, .x, xout = YEAR)$y, .names = "{.col}_linear")) %>%
pivot_longer(cols = c(ends_with("spline"), ends_with("linear")), names_to = c("BPL", "POP"), names_pattern = "(.*)_(.*)")
bpl_interp <- data.frame(YEAR = 1871:1921) %>% left_join(bplall %>% pivot_wider(id_cols = YEAR, names_from = BPL, values_from = POP)) %>%
mutate(across(-YEAR, function(.x) spline(YEAR, .x, method = "fmm", xout = YEAR)$y, .names = "{.col}_spline"),
across(-YEAR, function(.x) approx(YEAR, .x, xout = YEAR)$y, .names = "{.col}_linear")) %>%
select(c(ends_with("spline"), ends_with("linear"), "YEAR")) %>%
pivot_longer(cols = c(ends_with("spline"), ends_with("linear")), names_to = c("BPL", "POP"), names_pattern = "(.*)_(.*)")
bpl_interp <- data.frame(YEAR = 1871:1921) %>% left_join(bplall %>% pivot_wider(id_cols = YEAR, names_from = BPL, values_from = POP)) %>%
mutate(across(-YEAR, function(.x) spline(YEAR, .x, method = "fmm", xout = YEAR)$y, .names = "{.col}_spline"),
across(-YEAR, function(.x) approx(YEAR, .x, xout = YEAR)$y, .names = "{.col}_linear")) %>%
select(c(ends_with("spline"), ends_with("linear"), "YEAR")) %>%
pivot_longer(cols = c(ends_with("spline"), ends_with("linear")),
names_to = c("BPL", "INTERP"), names_pattern = "(.*)_(.*)", values_to = "POP")
names(bplall)
bpl_interp <- data.frame(YEAR = 1871:1921) %>% left_join(bplall %>% pivot_wider(id_cols = YEAR, names_from = BPL, values_from = POP)) %>%
mutate(across(-YEAR, function(.x) spline(YEAR, .x, method = "fmm", xout = YEAR)$y, .names = "{.col}_spline"),
across(-YEAR, function(.x) approx(YEAR, .x, xout = YEAR)$y, .names = "{.col}_linear")) %>%
select(c(ends_with("spline"), ends_with("linear"), "YEAR")) %>%
pivot_longer(cols = c(ends_with("spline"), ends_with("linear")),
names_to = c("BPL", "INTERP"), names_pattern = "(.*)_(.*)", values_to = "POP") %>%
rbind(bplall %>% mutate(INTERP = "none"))
ggplot(bpl_interp %>% filter(INTERP != "none"), aes(x = YEAR, y = POP, color = INTERP)) + geom_line() +
geom_point(data = bpl_interp %>% filter(INTERP == "none"), aes(x = YEAR, y = POP)) + facet_wrap(~BPL)
ggplot(bpl_interp %>% filter(INTERP != "none"), aes(x = YEAR, y = POP, color = INTERP)) + geom_line() +
geom_point(data = bpl_interp %>% filter(INTERP == "none"), aes(x = YEAR, y = POP)) + facet_wrap(~BPL)
dev.off()
ggplot(bpl_interp %>% filter(INTERP != "none"), aes(x = YEAR, y = POP, color = INTERP)) + geom_line() +
geom_point(data = bpl_interp %>% filter(INTERP == "none"), aes(x = YEAR, y = POP)) + facet_wrap(~BPL)
bpl_interp <- data.frame(YEAR = 1871:1921) %>% left_join(bplall %>% pivot_wider(id_cols = YEAR, names_from = BPL, values_from = POP)) %>%
mutate(across(-YEAR, function(.x) spline(YEAR, .x, method = "fmm", xout = YEAR)$y, .names = "{.col}_spline"),
across(-YEAR, function(.x) approx(YEAR, .x, xout = YEAR)$y, .names = "{.col}_linear")) %>%
select(c(ends_with("spline"), ends_with("linear"), "YEAR")) %>%
pivot_longer(cols = c(ends_with("spline"), ends_with("linear")),
names_to = c("BPL", "INTERP"), names_pattern = "(.*)_([A-z]*)$", values_to = "POP") %>%
rbind(bplall %>% mutate(INTERP = "none"))
ggplot(bpl_interp %>% filter(INTERP != "none"), aes(x = YEAR, y = POP, color = INTERP)) + geom_line() +
geom_point(data = bpl_interp %>% filter(INTERP == "none"), aes(x = YEAR, y = POP)) + facet_wrap(~BPL)
bpl_interp <- data.frame(YEAR = 1871:1921) %>% left_join(bplall %>% pivot_wider(id_cols = YEAR, names_from = BPL, values_from = POP)) %>%
mutate(across(-YEAR, function(.x) spline(YEAR, .x, method = "fmm", xout = YEAR)$y, .names = "{.col}_spline"),
across(-YEAR, function(.x) approx(YEAR, .x, xout = YEAR)$y, .names = "{.col}_linear")) %>%
select(c(ends_with("spline"), ends_with("linear"), "YEAR")) %>%
pivot_longer(cols = -YEAR, names_to = c("BPL", "INTERP"), names_pattern = "(.*)_([A-z]*)$", values_to = "POP") %>%
rbind(bplall %>% mutate(INTERP = "none"))
bpl_interp <- data.frame(YEAR = 1871:1921) %>% left_join(bplall %>% pivot_wider(id_cols = YEAR, names_from = BPL, values_from = POP)) %>%
mutate(across(-YEAR, function(.x) spline(YEAR, .x, method = "fmm", xout = YEAR)$y, .names = "{.col}_spline"),
across(-YEAR, function(.x) approx(YEAR, .x, xout = YEAR)$y, .names = "{.col}_linear")) %>%
select(c(ends_with("spline"), ends_with("linear"), "YEAR")) %>%
pivot_longer(cols = -YEAR, names_to = c("BPL", "INTERP"), names_pattern = "(.*)_(.*)", values_to = "POP") %>%
rbind(bplall %>% mutate(INTERP = "none"))
bpl_interp <- data.frame(YEAR = 1871:1921) %>% left_join(bplall %>% pivot_wider(id_cols = YEAR, names_from = BPL, values_from = POP)) %>%
mutate(across(-YEAR, function(.x) spline(YEAR, .x, method = "fmm", xout = YEAR)$y, .names = "{.col}_spline"),
across(-YEAR, function(.x) approx(YEAR, .x, xout = YEAR)$y, .names = "{.col}_linear")) %>%
select(c(ends_with("spline"), ends_with("linear"), "YEAR"))
names(bplall) <- names(bplall) %>% make.names()
bpl_interp <- data.frame(YEAR = 1871:1921) %>% left_join(bplall %>% pivot_wider(id_cols = YEAR, names_from = BPL, values_from = POP)) %>%
mutate(across(-YEAR, function(.x) spline(YEAR, .x, method = "fmm", xout = YEAR)$y, .names = "{.col}_spline"),
across(-YEAR, function(.x) approx(YEAR, .x, xout = YEAR)$y, .names = "{.col}_linear")) %>%
select(c(ends_with("spline"), ends_with("linear"), "YEAR")) %>%
pivot_longer(cols = -YEAR, names_to = c("BPL", "INTERP"), names_pattern = "(.*)_(.*)", values_to = "POP") %>%
rbind(bplall %>% mutate(INTERP = "none"))
names(bplall)
bpl_interp <- data.frame(YEAR = 1871:1921) %>% left_join(bplall %>% pivot_wider(id_cols = YEAR, names_from = BPL, values_from = POP)) %>%
mutate(across(-YEAR, function(.x) spline(YEAR, .x, method = "fmm", xout = YEAR)$y, .names = "{.col}_spline"),
across(-YEAR, function(.x) approx(YEAR, .x, xout = YEAR)$y, .names = "{.col}_linear")) %>%
select(c(ends_with("spline"), ends_with("linear"), "YEAR")) %>%
pivot_longer(cols = -YEAR, names_to = c("BPL", "INTERP"), names_pattern = "(.*)_(.*)", values_to = "POP") %>%
rbind(bplall %>% mutate(INTERP = "none"))
bpl_interp <- data.frame(YEAR = 1871:1921) %>% left_join(bplall %>% pivot_wider(id_cols = YEAR, names_from = BPL, values_from = POP)) %>%
mutate(across(-YEAR, function(.x) spline(YEAR, .x, method = "fmm", xout = YEAR)$y, .names = "{.col}_spline"),
across(-YEAR, function(.x) approx(YEAR, .x, xout = YEAR)$y, .names = "{.col}_linear")) %>%
select(c(ends_with("spline"), ends_with("linear"), "YEAR")) %>%
pivot_longer(cols = -YEAR, names_to = c("BPL", "INTERP"), names_pattern = "(.*)_(.*)", values_to = "POP")
#rbind(bplall %>% mutate(INTERP = "none"))
bpl_interp <- data.frame(YEAR = 1871:1921) %>% left_join(bplall %>% pivot_wider(id_cols = YEAR, names_from = BPL, values_from = POP)) %>%
mutate(across(-YEAR, function(.x) spline(YEAR, .x, method = "fmm", xout = YEAR)$y, .names = "{.col}_spline"),
across(-YEAR, function(.x) approx(YEAR, .x, xout = YEAR)$y, .names = "{.col}_linear")) %>%
select(c(ends_with("spline"), ends_with("linear"), "YEAR"))
names(bpl_interp)
#### interpolation
bpl_interp <- data.frame(YEAR = 1871:1921) %>% left_join(bplall %>% pivot_wider(id_cols = YEAR, names_from = BPL, values_from = POP)) %>%
mutate(across(-YEAR, function(.x) spline(YEAR, .x, method = "fmm", xout = YEAR)$y, .names = "{.col}_spline"),
across(-c(YEAR, ends_with("spline")), function(.x) approx(YEAR, .x, xout = YEAR)$y, .names = "{.col}_linear")) %>%
select(c(ends_with("spline"), ends_with("linear"), "YEAR")) %>%
pivot_longer(cols = -YEAR, names_to = c("BPL", "INTERP"), names_pattern = "(.*)_(.*)", values_to = "POP")
#rbind(bplall %>% mutate(INTERP = "none"))
ggplot(bpl_interp %>% filter(INTERP != "none"), aes(x = YEAR, y = POP, color = INTERP)) + geom_line() +
geom_point(data = bplall, aes(x = YEAR, y = POP)) + facet_wrap(~BPL)
bpl_interp <- data.frame(YEAR = 1871:1921) %>% left_join(bplall %>% pivot_wider(id_cols = YEAR, names_from = BPL, values_from = POP)) %>%
mutate(across(-YEAR, function(.x) spline(YEAR, .x, method = "fmm", xout = YEAR)$y, .names = "{.col}_spline"),
across(-c(YEAR, ends_with("spline")), function(.x) approx(YEAR, .x, xout = YEAR)$y, .names = "{.col}_linear")) %>%
select(c(ends_with("spline"), ends_with("linear"), "YEAR")) %>%
pivot_longer(cols = -YEAR, names_to = c("BPL", "INTERP"), names_pattern = "(.*)_(.*)", values_to = "POP")
#rbind(bplall %>% mutate(INTERP = "none"))
ggplot(bpl_interp %>% filter(INTERP != "none"), aes(x = YEAR, y = POP, color = INTERP)) + geom_line() +
geom_point(data = bplall, aes(x = YEAR, y = POP)) + facet_wrap(~BPL)
ggplot(bpl_interp %>% filter(INTERP != "none"), aes(x = YEAR, y = POP, color = INTERP)) + geom_line() +
geom_point(data = bplall, aes(x = YEAR, y = POP), inherit.aes = FALSE) + facet_wrap(~BPL)
ggplot(bpl_interp %>% filter(INTERP != "none" & BPL != "Canada"), aes(x = YEAR, y = POP, color = INTERP)) + geom_line() +
geom_point(data = bplall %>% filter(BPL != "Canada"), aes(x = YEAR, y = POP), inherit.aes = FALSE) + facet_wrap(~BPL)
ggplot(bpl_interp %>% filter(INTERP != "none" & BPL %in% bpllist_small), aes(x = YEAR, y = POP, color = INTERP)) + geom_line() +
geom_point(data = bplall %>% filter(BPL %in% bpllist_small), aes(x = YEAR, y = POP), inherit.aes = FALSE) + facet_wrap(~BPL)
bpllist_small = c("Belgium", "Denmark", "Finland", "France", "Germany", "Greece", "India",
"Japan", "Netherlands", "Norway","China", "Sweden")
ggplot(bpl_interp %>% filter(INTERP != "none" & BPL %in% bpllist_small), aes(x = YEAR, y = POP, color = INTERP)) + geom_line() +
geom_point(data = bplall %>% filter(BPL %in% bpllist_small), aes(x = YEAR, y = POP), inherit.aes = FALSE) + facet_wrap(~BPL)
bpllist_small = c("Belgium", "Denmark", "France", "Germany", "Greece", "India",
"Japan", "Netherlands", "Norway","China", "Sweden")
ggplot(bpl_interp %>% filter(INTERP != "none" & BPL %in% bpllist_small), aes(x = YEAR, y = POP, color = INTERP)) + geom_line() +
geom_point(data = bplall %>% filter(BPL %in% bpllist_small), aes(x = YEAR, y = POP), inherit.aes = FALSE) + facet_wrap(~BPL)
?spline
bpl_interp <- data.frame(YEAR = 1871:1921) %>% left_join(bplall %>% pivot_wider(id_cols = YEAR, names_from = BPL, values_from = POP)) %>%
mutate(across(-YEAR, function(.x) spline(YEAR, .x, method = "natural", xout = YEAR)$y, .names = "{.col}_spline"),
across(-c(YEAR, ends_with("spline")), function(.x) approx(YEAR, .x, xout = YEAR)$y, .names = "{.col}_linear")) %>%
select(c(ends_with("spline"), ends_with("linear"), "YEAR")) %>%
pivot_longer(cols = -YEAR, names_to = c("BPL", "INTERP"), names_pattern = "(.*)_(.*)", values_to = "POP")
#rbind(bplall %>% mutate(INTERP = "none"))
bpllist_small = c("Belgium", "Denmark", "France", "Germany", "Greece", "India",
"Japan", "Netherlands", "Norway","China", "Sweden")
ggplot(bpl_interp %>% filter(INTERP != "none" & BPL %in% bpllist_small), aes(x = YEAR, y = POP, color = INTERP)) + geom_line() +
geom_point(data = bplall %>% filter(BPL %in% bpllist_small), aes(x = YEAR, y = POP), inherit.aes = FALSE) + facet_wrap(~BPL)
?spline
bpllist_small = c("Belgium", "Denmark", "France", "Germany", "Greece", "India",
"Japan", "Netherlands", "Norway","China", "Sweden", "Finland")
ggplot(bpl_interp %>% filter(INTERP != "none" & BPL %in% bpllist_small), aes(x = YEAR, y = POP, color = INTERP)) + geom_line() +
geom_point(data = bplall %>% filter(BPL %in% bpllist_small), aes(x = YEAR, y = POP), inherit.aes = FALSE) + facet_wrap(~BPL)
write_csv(bpl_interp, glue("{dbox}/cleaned/popstock_can.csv"))
popstock <- read_csv(glue("{dbox}/cleaned/popstock_can.csv"))
yrimm_flow_regress <- yrimm_reg %>%
left_join(canhistmacro %>% select(c(Year, RGNP)), by = c("YRIMM" = "Year")) %>%
left_join(immflow, by = c("YRIMM" = "Year")) %>%
left_join(yrimm_census %>%
pivot_wider(id_cols = c(YRIMM, tax), names_from = BPL, names_prefix = "FLOW_",
values_from = FLOW), by = c("YRIMM", "tax")) %>%
left_join(can_imm %>% group_by(YRIMM) %>% summarize(FLOW_All = sum(WEIGHT))) %>% ungroup() %>%
arrange(YRIMM) %>% mutate(lagRGNP = dplyr::lag(RGNP),
t = YRIMM - 1885,
GNP_GROWTH = (RGNP - lagRGNP)/lagRGNP) %>%
filter(YRIMM <= 1910 & YRIMM >= 1880) %>% left_join(popstock %>% filter(INTERP == "spline"), by = c("YRIMM"="YEAR", "BPL"))
x <- left_join(yrimm_census %>% left_join(popstock %>% filter(INTERP == "spline"), by = c("YRIMM"="YEAR", "BPL")) %>%
pivot_wider(id_cols = c(YRIMM, tax), names_from = BPL,
values_from = c(FLOW, POP)), by = c("YRIMM", "tax"))
x <- yrimm_census %>% left_join(popstock %>% filter(INTERP == "spline"), by = c("YRIMM"="YEAR", "BPL")) %>%
pivot_wider(id_cols = c(YRIMM, tax), names_from = BPL,
values_from = c(FLOW, POP)), by = c("YRIMM", "tax")
x <- yrimm_census %>% left_join(popstock %>% filter(INTERP == "spline"), by = c("YRIMM"="YEAR", "BPL")) %>%
pivot_wider(id_cols = c(YRIMM, tax), names_from = BPL,
values_from = c(FLOW, POP), by = c("YRIMM", "tax"))
x <- yrimm_census %>% left_join(popstock %>% filter(INTERP == "spline"), by = c("YRIMM"="YEAR", "BPL")) %>%
pivot_wider(id_cols = c(YRIMM, tax), names_from = BPL,
values_from = c(FLOW, POP))
View(x)
yrimm_flow_regress <- yrimm_reg %>%
left_join(canhistmacro %>% select(c(Year, RGNP)), by = c("YRIMM" = "Year")) %>%
left_join(immflow, by = c("YRIMM" = "Year")) %>%
left_join(yrimm_census %>% left_join(popstock %>% filter(INTERP == "spline"), by = c("YRIMM"="YEAR", "BPL")) %>%
pivot_wider(id_cols = c(YRIMM, tax), names_from = BPL,
values_from = c(FLOW, POP)), by = c("YRIMM", "tax")) %>%
left_join(can_imm %>% group_by(YRIMM) %>% summarize(FLOW_All = sum(WEIGHT))) %>% ungroup() %>%
arrange(YRIMM) %>% mutate(lagRGNP = dplyr::lag(RGNP),
t = YRIMM - 1885,
GNP_GROWTH = (RGNP - lagRGNP)/lagRGNP) %>%
filter(YRIMM <= 1910 & YRIMM >= 1880)
names(yrimm_flow_regress)
names(yrimm_flow_regress) <- make.names(names(yrimm_flow_regress))
yrimm_flow1 <- lm(data = yrimm_flow_regress %>% filter(YRIMM > 1885), CHIFLOW_REGISTER ~ factor(tax) + t + I(t^2) + GNP_GROWTH + IMMFLOW_NATL)
summary(yrimm_flow1)
yrimm_flow2 <- lm(data = yrimm_flow_regress, FLOW_China ~ factor(tax) + t + I(t^2) + GNP_GROWTH + FLOW_All)
summary(yrimm_flow2)
summary(yrimm_flow3)
yrimm_flow3 <- lm(data = yrimm_flow_regress, FLOW_Japan ~ factor(tax) + t + I(t^2) +  GNP_GROWTH + FLOW_All)
summary(yrimm_flow3)
reg_countries <- c("India", "Belgium", "Australia.and.NZ", "France", "Poland", "Russia", "Italy", "Denmark", "Norway", "Germany",
"Switzerland", "Sweden", "West.Indies", "Austria.and.Hungary", "Finland" ,"China",  "Japan")%>%
make.names()
graph_country_regs <- list()
i = 1
for (country in reg_countries){
shiftcoef = -0.3 + (i-1)*(0.6/length(reg_countries))
reg <- lm(data = yrimm_flow_regress, glue("FLOW_{country} ~ factor(tax) + t + I(t^2) + GNP_GROWTH + FLOW_All"))
print(country)
print(summary(reg))
regcoef <- summary(reg)$coefficients
taxrows <- which(str_detect(rownames(regcoef),"factor\\(tax\\)"))
out <- as.data.frame(summary(reg)$coefficients[taxrows,1:2])
graph_country_regs[[i]] <- out %>%
mutate(tax = rownames(regcoef)[taxrows], meanimm = mean(yrimm_flow_regress[[glue("FLOW_{country}")]], na.rm=TRUE),
country = country, shift = shiftcoef)
i = i + 1
}
minyear = min(filter(yrimm_flow_regress, !is.na(FLOW_China))$YRIMM)
maxyear = max(filter(yrimm_flow_regress, !is.na(FLOW_China))$YRIMM)
graph_countries <- bind_rows(graph_country_regs) %>%
mutate(est_scale = Estimate/meanimm,
stderr_scale = `Std. Error`/meanimm,
est_lb = est_scale - 1.96*stderr_scale,
est_ub = est_scale + 1.96*stderr_scale,
taxyear = case_when(tax == "factor(tax)50" ~ 1 + shift,
tax == "factor(tax)100" ~ 2 + shift,
tax == "factor(tax)500" ~ 3 + shift))
# taxyear = case_when(tax == "factor(tax)0" ~ minyear + (1885-minyear)/2,
#                     tax == "factor(tax)50" ~ 1885 + (1900-1885)/2,
#                     tax == "factor(tax)100" ~ 1900 + (1903-1900)/2,
#                     tax == "factor(tax)500" ~ 1903 + (maxyear-1903)/2))
ggplot(graph_countries %>% filter(country != "China" & country != "Japan" & country != "India"), aes(x = taxyear, y = est_scale, group = country, color = 'other')) + geom_point() +
geom_errorbar(aes(min = est_lb, max = est_ub), width = 0.1, color = "grey") +
geom_point(data = graph_countries %>% filter(country == "Japan"), aes(x = taxyear, y = est_scale, color = "japan")) +
geom_errorbar(data = graph_countries %>% filter(country == "Japan"), aes(min = est_lb, max = est_ub), width = 0.1, color = "orange") +
geom_point(data = graph_countries %>% filter(country == "India"), aes(x = taxyear, y = est_scale, color = "india")) +
geom_errorbar(data = graph_countries %>% filter(country == "India"), aes(min = est_lb, max = est_ub), width = 0.1, color = "green") +
geom_point(data = graph_countries %>% filter(country == "China"), aes(x = taxyear, y = est_scale, color = 'china')) +
geom_errorbar(data = graph_countries %>% filter(country == "China"), aes(min = est_lb, max = est_ub), width = 0.1, color = "red") +
scale_x_continuous("", breaks = c(1,2,3), labels = c("1"="$50 Head Tax","2"="$100 Head Tax","3"="$500 Head Tax")) +
labs(y = "Coefficient (Scaled by Mean Imm. Inflow)") +
scale_color_manual(name = "Country", breaks = c('other', 'china','japan','india'),
values = c('other' = 'grey', 'china'='red','japan'='orange','india'='green')) +
ggtitle("Inflow Regression Coefficients by Country (1880-1910)")
reg_countries <- c("India", "Belgium", "Australia.and.NZ", "France", "Poland", "Russia", "Italy", "Denmark", "Norway", "Germany",
"Switzerland", "Sweden", "West.Indies", "Austria.and.Hungary", "Finland" ,"China",  "Japan")%>%
make.names()
graph_country_regs <- list()
i = 1
for (country in reg_countries){
shiftcoef = -0.3 + (i-1)*(0.6/length(reg_countries))
#reg <- lm(data = yrimm_flow_regress, glue("FLOW_{country} ~ factor(tax) + t + I(t^2) + GNP_GROWTH + FLOW_All"))
reg <- lm(data = yrimm_flow_regress, glue("FLOW_{country} ~ factor(tax) + POP_{country} + GNP_GROWTH + FLOW_All"))
print(country)
print(summary(reg))
regcoef <- summary(reg)$coefficients
taxrows <- which(str_detect(rownames(regcoef),"factor\\(tax\\)"))
out <- as.data.frame(summary(reg)$coefficients[taxrows,1:2])
graph_country_regs[[i]] <- out %>%
mutate(tax = rownames(regcoef)[taxrows], meanimm = mean(yrimm_flow_regress[[glue("FLOW_{country}")]], na.rm=TRUE),
country = country, shift = shiftcoef)
i = i + 1
}
minyear = min(filter(yrimm_flow_regress, !is.na(FLOW_China))$YRIMM)
maxyear = max(filter(yrimm_flow_regress, !is.na(FLOW_China))$YRIMM)
graph_countries <- bind_rows(graph_country_regs) %>%
mutate(est_scale = Estimate/meanimm,
stderr_scale = `Std. Error`/meanimm,
est_lb = est_scale - 1.96*stderr_scale,
est_ub = est_scale + 1.96*stderr_scale,
taxyear = case_when(tax == "factor(tax)50" ~ 1 + shift,
tax == "factor(tax)100" ~ 2 + shift,
tax == "factor(tax)500" ~ 3 + shift))
# taxyear = case_when(tax == "factor(tax)0" ~ minyear + (1885-minyear)/2,
#                     tax == "factor(tax)50" ~ 1885 + (1900-1885)/2,
#                     tax == "factor(tax)100" ~ 1900 + (1903-1900)/2,
#                     tax == "factor(tax)500" ~ 1903 + (maxyear-1903)/2))
ggplot(graph_countries %>% filter(country != "China" & country != "Japan" & country != "India"), aes(x = taxyear, y = est_scale, group = country, color = 'other')) + geom_point() +
geom_errorbar(aes(min = est_lb, max = est_ub), width = 0.1, color = "grey") +
geom_point(data = graph_countries %>% filter(country == "Japan"), aes(x = taxyear, y = est_scale, color = "japan")) +
geom_errorbar(data = graph_countries %>% filter(country == "Japan"), aes(min = est_lb, max = est_ub), width = 0.1, color = "orange") +
geom_point(data = graph_countries %>% filter(country == "India"), aes(x = taxyear, y = est_scale, color = "india")) +
geom_errorbar(data = graph_countries %>% filter(country == "India"), aes(min = est_lb, max = est_ub), width = 0.1, color = "green") +
geom_point(data = graph_countries %>% filter(country == "China"), aes(x = taxyear, y = est_scale, color = 'china')) +
geom_errorbar(data = graph_countries %>% filter(country == "China"), aes(min = est_lb, max = est_ub), width = 0.1, color = "red") +
scale_x_continuous("", breaks = c(1,2,3), labels = c("1"="$50 Head Tax","2"="$100 Head Tax","3"="$500 Head Tax")) +
labs(y = "Coefficient (Scaled by Mean Imm. Inflow)") +
scale_color_manual(name = "Country", breaks = c('other', 'china','japan','india'),
values = c('other' = 'grey', 'china'='red','japan'='orange','india'='green')) +
ggtitle("Inflow Regression Coefficients by Country (1880-1910)")
minyear = min(filter(yrimm_flow_regress, !is.na(FLOW_China))$YRIMM)
maxyear = max(filter(yrimm_flow_regress, !is.na(FLOW_China))$YRIMM)
graph_countries <- bind_rows(graph_country_regs) %>%
mutate(est_scale = log(Estimate/meanimm),
stderr_scale = log(`Std. Error`/meanimm),
est_lb = est_scale - 1.96*stderr_scale,
est_ub = est_scale + 1.96*stderr_scale,
taxyear = case_when(tax == "factor(tax)50" ~ 1 + shift,
tax == "factor(tax)100" ~ 2 + shift,
tax == "factor(tax)500" ~ 3 + shift))
# taxyear = case_when(tax == "factor(tax)0" ~ minyear + (1885-minyear)/2,
#                     tax == "factor(tax)50" ~ 1885 + (1900-1885)/2,
#                     tax == "factor(tax)100" ~ 1900 + (1903-1900)/2,
#                     tax == "factor(tax)500" ~ 1903 + (maxyear-1903)/2))
ggplot(graph_countries %>% filter(country != "China" & country != "Japan" & country != "India"), aes(x = taxyear, y = est_scale, group = country, color = 'other')) + geom_point() +
geom_errorbar(aes(min = est_lb, max = est_ub), width = 0.1, color = "grey") +
geom_point(data = graph_countries %>% filter(country == "Japan"), aes(x = taxyear, y = est_scale, color = "japan")) +
geom_errorbar(data = graph_countries %>% filter(country == "Japan"), aes(min = est_lb, max = est_ub), width = 0.1, color = "orange") +
geom_point(data = graph_countries %>% filter(country == "India"), aes(x = taxyear, y = est_scale, color = "india")) +
geom_errorbar(data = graph_countries %>% filter(country == "India"), aes(min = est_lb, max = est_ub), width = 0.1, color = "green") +
geom_point(data = graph_countries %>% filter(country == "China"), aes(x = taxyear, y = est_scale, color = 'china')) +
geom_errorbar(data = graph_countries %>% filter(country == "China"), aes(min = est_lb, max = est_ub), width = 0.1, color = "red") +
scale_x_continuous("", breaks = c(1,2,3), labels = c("1"="$50 Head Tax","2"="$100 Head Tax","3"="$500 Head Tax")) +
labs(y = "Coefficient (Scaled by Mean Imm. Inflow)") +
scale_color_manual(name = "Country", breaks = c('other', 'china','japan','india'),
values = c('other' = 'grey', 'china'='red','japan'='orange','india'='green')) +
ggtitle("Inflow Regression Coefficients by Country (1880-1910)")
View(graph_countries)
graph_countries <- bind_rows(graph_country_regs) %>%
mutate(est_scale = Estimate/meanimm,
stderr_scale = `Std. Error`/meanimm,
est_lb = est_scale - 1.96*stderr_scale,
est_ub = est_scale + 1.96*stderr_scale,
taxyear = case_when(tax == "factor(tax)50" ~ 1 + shift,
tax == "factor(tax)100" ~ 2 + shift,
tax == "factor(tax)500" ~ 3 + shift))
# taxyear = case_when(tax == "factor(tax)0" ~ minyear + (1885-minyear)/2,
#                     tax == "factor(tax)50" ~ 1885 + (1900-1885)/2,
#                     tax == "factor(tax)100" ~ 1900 + (1903-1900)/2,
#                     tax == "factor(tax)500" ~ 1903 + (maxyear-1903)/2))
ggplot(graph_countries %>% filter(country != "China" & country != "Japan" & country != "India"), aes(x = taxyear, y = est_scale, group = country, color = 'other')) + geom_point() +
geom_errorbar(aes(min = est_lb, max = est_ub), width = 0.1, color = "grey") +
geom_point(data = graph_countries %>% filter(country == "Japan"), aes(x = taxyear, y = est_scale, color = "japan")) +
geom_errorbar(data = graph_countries %>% filter(country == "Japan"), aes(min = est_lb, max = est_ub), width = 0.1, color = "orange") +
geom_point(data = graph_countries %>% filter(country == "India"), aes(x = taxyear, y = est_scale, color = "india")) +
geom_errorbar(data = graph_countries %>% filter(country == "India"), aes(min = est_lb, max = est_ub), width = 0.1, color = "green") +
geom_point(data = graph_countries %>% filter(country == "China"), aes(x = taxyear, y = est_scale, color = 'china')) +
geom_errorbar(data = graph_countries %>% filter(country == "China"), aes(min = est_lb, max = est_ub), width = 0.1, color = "red") +
scale_x_continuous("", breaks = c(1,2,3), labels = c("1"="$50 Head Tax","2"="$100 Head Tax","3"="$500 Head Tax")) +
labs(y = "Coefficient (Scaled by Mean Imm. Inflow)") +
scale_color_manual(name = "Country", breaks = c('other', 'china','japan','india'),
values = c('other' = 'grey', 'china'='red','japan'='orange','india'='green')) +
ggtitle("Inflow Regression Coefficients by Country (1880-1910)")
graph_country_regs <- list()
i = 1
for (country in reg_countries){
shiftcoef = -0.3 + (i-1)*(0.6/length(reg_countries))
#reg <- lm(data = yrimm_flow_regress, glue("FLOW_{country} ~ factor(tax) + t + I(t^2) + GNP_GROWTH + FLOW_All"))
reg <- lm(data = yrimm_flow_regress, glue("FLOW_{country} ~ factor(tax) + POP_{country} + GNP_GROWTH + FLOW_All"))
print(country)
print(summary(reg))
regcoef <- summary(reg)$coefficients
taxrows <- which(str_detect(rownames(regcoef),"factor\\(tax\\)"))
out <- as.data.frame(summary(reg)$coefficients[taxrows,1:2])
graph_country_regs[[i]] <- out %>%
mutate(tax = rownames(regcoef)[taxrows], meanimm = mean(yrimm_flow_regress[[glue("FLOW_{country}")]], na.rm=TRUE),
country = country, shift = shiftcoef)
i = i + 1
}
minyear = min(filter(yrimm_flow_regress, !is.na(FLOW_China))$YRIMM)
maxyear = max(filter(yrimm_flow_regress, !is.na(FLOW_China))$YRIMM)
graph_countries <- bind_rows(graph_country_regs) %>%
mutate(est_scale = asinh(Estimate/meanimm),
stderr_scale = asinh(`Std. Error`/meanimm),
est_lb = est_scale - 1.96*stderr_scale,
est_ub = est_scale + 1.96*stderr_scale,
taxyear = case_when(tax == "factor(tax)50" ~ 1 + shift,
tax == "factor(tax)100" ~ 2 + shift,
tax == "factor(tax)500" ~ 3 + shift))
# taxyear = case_when(tax == "factor(tax)0" ~ minyear + (1885-minyear)/2,
#                     tax == "factor(tax)50" ~ 1885 + (1900-1885)/2,
#                     tax == "factor(tax)100" ~ 1900 + (1903-1900)/2,
#                     tax == "factor(tax)500" ~ 1903 + (maxyear-1903)/2))
ggplot(graph_countries %>% filter(country != "China" & country != "Japan" & country != "India"), aes(x = taxyear, y = est_scale, group = country, color = 'other')) + geom_point() +
geom_errorbar(aes(min = est_lb, max = est_ub), width = 0.1, color = "grey") +
geom_point(data = graph_countries %>% filter(country == "Japan"), aes(x = taxyear, y = est_scale, color = "japan")) +
geom_errorbar(data = graph_countries %>% filter(country == "Japan"), aes(min = est_lb, max = est_ub), width = 0.1, color = "orange") +
geom_point(data = graph_countries %>% filter(country == "India"), aes(x = taxyear, y = est_scale, color = "india")) +
geom_errorbar(data = graph_countries %>% filter(country == "India"), aes(min = est_lb, max = est_ub), width = 0.1, color = "green") +
geom_point(data = graph_countries %>% filter(country == "China"), aes(x = taxyear, y = est_scale, color = 'china')) +
geom_errorbar(data = graph_countries %>% filter(country == "China"), aes(min = est_lb, max = est_ub), width = 0.1, color = "red") +
scale_x_continuous("", breaks = c(1,2,3), labels = c("1"="$50 Head Tax","2"="$100 Head Tax","3"="$500 Head Tax")) +
labs(y = "Coefficient (Scaled by Mean Imm. Inflow)") +
scale_color_manual(name = "Country", breaks = c('other', 'china','japan','india'),
values = c('other' = 'grey', 'china'='red','japan'='orange','india'='green')) +
ggtitle("Inflow Regression Coefficients by Country (1880-1910)")
graph_countries <- bind_rows(graph_country_regs) %>%
mutate(est_scale = asinh(Estimate/meanimm),
stderr_scale = asinh(`Std. Error`/meanimm),
est_lb = est_scale - 1.96*stderr_scale,
est_ub = est_scale + 1.96*stderr_scale) %>%
arrange(desc(est_scale)) %>% group_by(country) %>%
mutate(shift = cur_group_id())
?cur_group_id
graph_countries <- bind_rows(graph_country_regs) %>%
mutate(est_scale = asinh(Estimate/meanimm),
stderr_scale = asinh(`Std. Error`/meanimm),
est_lb = est_scale - 1.96*stderr_scale,
est_ub = est_scale + 1.96*stderr_scale) %>%
arrange(desc(est_scale))
country_order <- arrange(graph_countries %>% filter(tax == "factor(tax)50"), desc(est_scale))$country
country_order
graph_countries <- bind_rows(graph_country_regs) %>%
mutate(est_scale = asinh(Estimate/meanimm),
stderr_scale = asinh(`Std. Error`/meanimm),
est_lb = est_scale - 1.96*stderr_scale,
est_ub = est_scale + 1.96*stderr_scale) %>%
arrange(desc(est_scale)) %>%
group_by(tax) %>%
mutate(row = row_number())
graph_countries <- bind_rows(graph_country_regs) %>%
mutate(est_scale = asinh(Estimate/meanimm),
stderr_scale = asinh(`Std. Error`/meanimm),
est_lb = est_scale - 1.96*stderr_scale,
est_ub = est_scale + 1.96*stderr_scale) %>%
group_by(tax) %>%
arrange(desc(est_scale)) %>%
mutate(row = row_number())
graph_countries <- bind_rows(graph_country_regs) %>%
mutate(est_scale = asinh(Estimate/meanimm),
stderr_scale = asinh(`Std. Error`/meanimm),
est_lb = est_scale - 1.96*stderr_scale,
est_ub = est_scale + 1.96*stderr_scale) %>%
group_by(tax) %>%
arrange(desc(est_scale), .by = tax) %>%
mutate(row = row_number())
?arrange
graph_countries <- bind_rows(graph_country_regs) %>%
mutate(est_scale = asinh(Estimate/meanimm),
stderr_scale = asinh(`Std. Error`/meanimm),
est_lb = est_scale - 1.96*stderr_scale,
est_ub = est_scale + 1.96*stderr_scale) %>%
group_by(tax) %>%
arrange(desc(est_scale), .by_group = TRUE) %>%
mutate(row = row_number())
graph_countries <- bind_rows(graph_country_regs) %>%
mutate(est_scale = asinh(Estimate/meanimm),
stderr_scale = asinh(`Std. Error`/meanimm),
est_lb = est_scale - 1.96*stderr_scale,
est_ub = est_scale + 1.96*stderr_scale) %>%
group_by(tax) %>%
arrange(desc(est_scale), .by_group = TRUE) %>%
mutate(row = row_number(),
shift = -0.3 + (row-1)*(0.6/max(row)),
taxyear = case_when(tax == "factor(tax)50" ~ 1 + shift,
tax == "factor(tax)100" ~ 2 + shift,
tax == "factor(tax)500" ~ 3 + shift))
# taxyear = case_when(tax == "factor(tax)0" ~ minyear + (1885-minyear)/2,
#                     tax == "factor(tax)50" ~ 1885 + (1900-1885)/2,
#                     tax == "factor(tax)100" ~ 1900 + (1903-1900)/2,
#                     tax == "factor(tax)500" ~ 1903 + (maxyear-1903)/2))
ggplot(graph_countries %>% filter(country != "China" & country != "Japan" & country != "India"), aes(x = taxyear, y = est_scale, group = country, color = 'other')) + geom_point() +
geom_errorbar(aes(min = est_lb, max = est_ub), width = 0.1, color = "grey") +
geom_point(data = graph_countries %>% filter(country == "Japan"), aes(x = taxyear, y = est_scale, color = "japan")) +
geom_errorbar(data = graph_countries %>% filter(country == "Japan"), aes(min = est_lb, max = est_ub), width = 0.1, color = "orange") +
geom_point(data = graph_countries %>% filter(country == "India"), aes(x = taxyear, y = est_scale, color = "india")) +
geom_errorbar(data = graph_countries %>% filter(country == "India"), aes(min = est_lb, max = est_ub), width = 0.1, color = "green") +
geom_point(data = graph_countries %>% filter(country == "China"), aes(x = taxyear, y = est_scale, color = 'china')) +
geom_errorbar(data = graph_countries %>% filter(country == "China"), aes(min = est_lb, max = est_ub), width = 0.1, color = "red") +
scale_x_continuous("", breaks = c(1,2,3), labels = c("1"="$50 Head Tax","2"="$100 Head Tax","3"="$500 Head Tax")) +
labs(y = "Coefficient (Scaled by Mean Imm. Inflow)") +
scale_color_manual(name = "Country", breaks = c('other', 'china','japan','india'),
values = c('other' = 'grey', 'china'='red','japan'='orange','india'='green')) +
ggtitle("Inflow Regression Coefficients by Country (1880-1910)")
